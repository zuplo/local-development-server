var De=Object.defineProperty;var e=(o,n)=>De(o,"name",{value:n,configurable:!0});import{bundle as sr,transpile as ar}from"https://deno.land/x/emit@0.29.0/mod.ts";import{load as cr}from"https://deno.land/std@0.203.0/dotenv/mod.ts";import{createOAuth2Token as lr}from"https://deno.land/x/deno_gcp_admin@0.0.5/auth.ts";import{parse as dr}from"https://deno.land/std@0.203.0/flags/mod.ts";import{Server as pr}from"https://deno.land/std@0.203.0/http/server.ts";import*as gr from"https://deno.land/std@0.203.0/fs/mod.ts";import*as hr from"https://deno.land/std@0.203.0/http/http_status.ts";import*as U from"https://deno.land/std@0.203.0/log/mod.ts";import*as vr from"https://deno.land/std@0.203.0/path/mod.ts";import{deferred as _r}from"https://deno.land/std@0.203.0/async/deferred.ts";import{assert as Er,assertAlmostEquals as Lr,assertArrayIncludes as Sr,assertEquals as Mr,assertExists as Cr,assertFalse as jr,assertInstanceOf as wr,assertIsError as Tr,assertMatch as Dr,assertNotEquals as Br,assertNotMatch as Nr,assertNotStrictEquals as Pr,assertObjectMatch as Ar,assertRejects as xr,assertStrictEquals as Rr,assertStringIncludes as Fr,assertThrows as Ir,equal as Kr,fail as $r,unimplemented as qr,unreachable as Hr}from"https://deno.land/std@0.203.0/assert/mod.ts";import{afterAll as Wr,afterEach as Ur,beforeAll as Gr,beforeEach as Yr,describe as zr,it as kr}from"https://deno.land/std@0.203.0/testing/bdd.ts";var Be=Object.getOwnPropertyNames,A=e((o,n)=>e(function(){return n||(0,o[Be(o)[0]])((n={exports:{}}).exports,n),n.exports},"__require"),"__commonJS"),Ne=A({"node_modules/secure-json-parse/index.js"(o,n){"use strict";var s=typeof Buffer<"u",c=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,a=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function i(h,C,E){E==null&&C!==null&&typeof C=="object"&&(E=C,C=void 0),s&&Buffer.isBuffer(h)&&(h=h.toString()),h&&h.charCodeAt(0)===65279&&(h=h.slice(1));let l=JSON.parse(h,C);if(l===null||typeof l!="object")return l;let L=E&&E.protoAction||"error",r=E&&E.constructorAction||"error";if(L==="ignore"&&r==="ignore")return l;if(L!=="ignore"&&r!=="ignore"){if(c.test(h)===!1&&a.test(h)===!1)return l}else if(L!=="ignore"&&r==="ignore"){if(c.test(h)===!1)return l}else if(a.test(h)===!1)return l;return u(l,{protoAction:L,constructorAction:r,safe:E&&E.safe})}e(i,"_parse");function u(h,{protoAction:C="error",constructorAction:E="error",safe:l}={}){let L=[h];for(;L.length;){let r=L;L=[];for(let p of r){if(C!=="ignore"&&Object.prototype.hasOwnProperty.call(p,"__proto__")){if(l===!0)return null;if(C==="error")throw new SyntaxError("Object contains forbidden prototype property");delete p.__proto__}if(E!=="ignore"&&Object.prototype.hasOwnProperty.call(p,"constructor")&&Object.prototype.hasOwnProperty.call(p.constructor,"prototype")){if(l===!0)return null;if(E==="error")throw new SyntaxError("Object contains forbidden prototype property");delete p.constructor}for(let g in p){let d=p[g];d&&typeof d=="object"&&L.push(d)}}}return h}e(u,"filter");function f(h,C,E){let l=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(h,C,E)}finally{Error.stackTraceLimit=l}}e(f,"parse");function O(h,C){let E=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(h,C,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=E}}e(O,"safeParse"),n.exports=f,n.exports.default=f,n.exports.parse=f,n.exports.safeParse=O,n.exports.scan=u}}),Oe=A({"lib/utils/is-object.js"(o,n){"use strict";n.exports=s;function s(c){return Object.prototype.toString.apply(c)==="[object Object]"}e(s,"isObject")}}),re=A({"lib/constants.js"(o,n){"use strict";n.exports={DATE_FORMAT:"yyyy-mm-dd HH:MM:ss.l o",DATE_FORMAT_SIMPLE:"HH:MM:ss.l",ERROR_LIKE_KEYS:["err","error"],MESSAGE_KEY:"msg",LEVEL_KEY:"level",LEVEL_LABEL:"levelLabel",TIMESTAMP_KEY:"time",LEVELS:{default:"USERLVL",60:"FATAL",50:"ERROR",40:"WARN",30:"INFO",20:"DEBUG",10:"TRACE"},LEVEL_NAMES:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},LOGGER_KEYS:["pid","hostname","name","level","time","timestamp","caller"]}}}),he=A({"lib/utils/join-lines-with-indentation.js"(o,n){"use strict";n.exports=s;function s({input:c,ident:a="    ",eol:i=`
`}){let u=c.split(/\r?\n/);for(let f=1;f<u.length;f+=1)u[f]=a+u[f];return u.join(i)}e(s,"joinLinesWithIndentation")}}),Pe=A({"node_modules/fast-safe-stringify/index.js"(o,n){n.exports=f,f.default=f,f.stable=E,f.stableStringify=E;var s="[...]",c="[Circular]",a=[],i=[];function u(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}e(u,"defaultOptions");function f(r,p,g,d){typeof d>"u"&&(d=u()),h(r,"",0,[],void 0,0,d);var b;try{i.length===0?b=JSON.stringify(r,p,g):b=JSON.stringify(r,L(p),g)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;a.length!==0;){var _=a.pop();_.length===4?Object.defineProperty(_[0],_[1],_[3]):_[0][_[1]]=_[2]}}return b}e(f,"stringify");function O(r,p,g,d){var b=Object.getOwnPropertyDescriptor(d,g);b.get!==void 0?b.configurable?(Object.defineProperty(d,g,{value:r}),a.push([d,g,p,b])):i.push([p,g,r]):(d[g]=r,a.push([d,g,p]))}e(O,"setReplace");function h(r,p,g,d,b,_,w){_+=1;var M;if(typeof r=="object"&&r!==null){for(M=0;M<d.length;M++)if(d[M]===r){O(c,r,p,b);return}if(typeof w.depthLimit<"u"&&_>w.depthLimit){O(s,r,p,b);return}if(typeof w.edgesLimit<"u"&&g+1>w.edgesLimit){O(s,r,p,b);return}if(d.push(r),Array.isArray(r))for(M=0;M<r.length;M++)h(r[M],M,M,d,r,_,w);else{var m=Object.keys(r);for(M=0;M<m.length;M++){var v=m[M];h(r[v],v,M,d,r,_,w)}}d.pop()}}e(h,"decirc");function C(r,p){return r<p?-1:r>p?1:0}e(C,"compareFunction");function E(r,p,g,d){typeof d>"u"&&(d=u());var b=l(r,"",0,[],void 0,0,d)||r,_;try{i.length===0?_=JSON.stringify(b,p,g):_=JSON.stringify(b,L(p),g)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;a.length!==0;){var w=a.pop();w.length===4?Object.defineProperty(w[0],w[1],w[3]):w[0][w[1]]=w[2]}}return _}e(E,"deterministicStringify");function l(r,p,g,d,b,_,w){_+=1;var M;if(typeof r=="object"&&r!==null){for(M=0;M<d.length;M++)if(d[M]===r){O(c,r,p,b);return}try{if(typeof r.toJSON=="function")return}catch{return}if(typeof w.depthLimit<"u"&&_>w.depthLimit){O(s,r,p,b);return}if(typeof w.edgesLimit<"u"&&g+1>w.edgesLimit){O(s,r,p,b);return}if(d.push(r),Array.isArray(r))for(M=0;M<r.length;M++)l(r[M],M,M,d,r,_,w);else{var m={},v=Object.keys(r).sort(C);for(M=0;M<v.length;M++){var j=v[M];l(r[j],j,M,d,r,_,w),m[j]=r[j]}if(typeof b<"u")a.push([b,p,r]),b[p]=m;else return m}d.pop()}}e(l,"deterministicDecirc");function L(r){return r=typeof r<"u"?r:function(p,g){return g},function(p,g){if(i.length>0)for(var d=0;d<i.length;d++){var b=i[d];if(b[1]===p&&b[0]===g){g=b[2],i.splice(d,1);break}}return r.call(this,p,g)}}e(L,"replaceGetterValues")}}),Ae=A({"lib/utils/prettify-error.js"(o,n){"use strict";n.exports=c;var s=he();function c({keyName:a,lines:i,eol:u,ident:f}){let O="",h=s({input:i,ident:f,eol:u}),C=`${f}${a}: ${h}${u}`.split(u);for(let E=0;E<C.length;E+=1){E!==0&&(O+=u);let l=C[E];if(/^\s*"stack"/.test(l)){let L=/^(\s*"stack":)\s*(".*"),?$/.exec(l);if(L&&L.length===3){let r=/^\s*/.exec(l)[0].length+4,p=" ".repeat(r),g=L[2];O+=L[1]+u+p+JSON.parse(g).replace(/\n/g,u+p)}else O+=l}else O+=l}return O}e(c,"prettifyError")}}),Ee=A({"lib/utils/prettify-object.js"(o,n){"use strict";n.exports=u;var{LOGGER_KEYS:s}=re(),c=Pe(),a=he(),i=Ae();function u({log:f,excludeLoggerKeys:O=!0,skipKeys:h=[],context:C}){let{EOL:E,IDENT:l,customPrettifiers:L,errorLikeObjectKeys:r,objectColorizer:p,singleLine:g}=C,d=[].concat(h);O===!0&&Array.prototype.push.apply(d,s);let b="",{plain:_,errors:w}=Object.entries(f).reduce(({plain:M,errors:m},[v,j])=>{if(d.includes(v)===!1){let T=typeof L[v]=="function"?L[v](j,v,f):j;r.includes(v)?m[v]=T:M[v]=T}return{plain:M,errors:m}},{plain:{},errors:{}});return g?(Object.keys(_).length>0&&(b+=p.greyMessage(c(_))),b+=E,b=b.replace(/\\\\/gi,"\\")):Object.entries(_).forEach(([M,m])=>{let v=typeof L[M]=="function"?m:c(m,null,2);if(v===void 0)return;v=v.replace(/\\\\/gi,"\\");let j=a({input:v,ident:l,eol:E});b+=`${l}${M}:${j.startsWith(E)?"":" "}${j}${E}`}),Object.entries(w).forEach(([M,m])=>{let v=typeof L[M]=="function"?m:c(m,null,2);v!==void 0&&(b+=i({keyName:M,lines:v,eol:E,ident:l}))}),b}e(u,"prettifyObject")}}),xe=A({"lib/utils/prettify-error-log.js"(o,n){"use strict";n.exports=u;var{LOGGER_KEYS:s}=re(),c=Oe(),a=he(),i=Ee();function u({log:f,context:O}){let{EOL:h,IDENT:C,errorProps:E,messageKey:l}=O,L=f.stack,r=a({input:L,ident:C,eol:h}),p=`${C}${r}${h}`;if(E.length>0){let g=s.concat(l,"type","stack"),d;E[0]==="*"?d=Object.keys(f).filter(b=>g.includes(b)===!1):d=E.filter(b=>g.includes(b)===!1);for(let b=0;b<d.length;b+=1){let _=d[b];if(_ in f){if(c(f[_])){let w=i({log:f[_],excludeLoggerKeys:!1,context:{...O,IDENT:C+C}});p=`${p}${C}${_}: {${h}${w}${C}}${h}`;continue}p=`${p}${C}${_}: ${f[_]}${h}`}}}return p}e(u,"prettifyErrorLog")}}),Le=A({"lib/utils/split-property-key.js"(o,n){"use strict";n.exports=s;function s(c){let a=[],i=!1,u="";for(let f=0;f<c.length;f++){let O=c.charAt(f);if(O==="\\"){i=!0;continue}if(i){i=!1,u+=O;continue}if(O==="."){a.push(u),u="";continue}u+=O}return u.length&&a.push(u),a}e(s,"splitPropertyKey")}}),se=A({"lib/utils/get-property-value.js"(o,n){"use strict";n.exports=c;var s=Le();function c(a,i){let u=Array.isArray(i)?i:s(i);for(let f of u){if(!Object.prototype.hasOwnProperty.call(a,f))return;a=a[f]}return a}e(c,"getPropertyValue")}}),Re=A({"lib/utils/prettify-level.js"(o,n){"use strict";n.exports=c;var s=se();function c({log:a,context:i}){let{colorizer:u,customLevels:f,customLevelNames:O,levelKey:h}=i,C=i.customPrettifiers?.level,E=s(a,h);if(E!==void 0)return C?C(E):u(E,{customLevels:f,customLevelNames:O})}e(c,"prettifyLevel")}}),Fe=A({"lib/utils/interpret-conditionals.js"(o,n){"use strict";n.exports=c;var s=se();function c(a,i){return a=a.replace(/{if (.*?)}(.*?){end}/g,u),a=a.replace(/{if (.*?)}/g,""),a=a.replace(/{end}/g,""),a.replace(/\s+/g," ").trim();function u(f,O,h){let C=s(i,O);return C&&h.includes(O)?h.replace(new RegExp("{"+O+"}","g"),C):""}e(u,"replacer")}e(c,"interpretConditionals")}}),Ie=A({"lib/utils/prettify-message.js"(o,n){"use strict";n.exports=i;var{LEVELS:s}=re(),c=se(),a=Fe();function i({log:u,context:f}){let{colorizer:O,customLevels:h,levelKey:C,levelLabel:E,messageFormat:l,messageKey:L,useOnlyCustomProps:r}=f;if(l&&typeof l=="string"){let p=a(l,u),g=String(p).replace(/{([^{}]+)}/g,function(d,b){let _;return b===E&&(_=c(u,C))!==void 0?(r?h===void 0:h[_]===void 0)?s[_]:h[_]:c(u,b)||""});return O.message(g)}if(l&&typeof l=="function"){let p=l(u,L,E);return O.message(p)}if(L in u&&!(typeof u[L]!="string"&&typeof u[L]!="number"&&typeof u[L]!="boolean"))return O.message(u[L])}e(i,"prettifyMessage")}}),Ke=A({"lib/utils/prettify-metadata.js"(o,n){"use strict";n.exports=s;function s({log:c,context:a}){let i=a.customPrettifiers,u="";if(c.name||c.pid||c.hostname){if(u+="(",c.name&&(u+=i.name?i.name(c.name):c.name),c.pid){let f=i.pid?i.pid(c.pid):c.pid;c.name&&c.pid?u+="/"+f:u+=f}c.hostname&&(u+=`${u==="("?"on":" on"} ${i.hostname?i.hostname(c.hostname):c.hostname}`),u+=")"}if(c.caller&&(u+=`${u===""?"":" "}<${i.caller?i.caller(c.caller):c.caller}>`),u!=="")return u}e(s,"prettifyMetadata")}}),$e=A({"node_modules/dateformat/lib/dateformat.js"(o,n){"use strict";function s(c){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?s=e(function(i){return typeof i},"_typeof2"):s=e(function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},"_typeof2"),s(c)}e(s,"_typeof"),function(c){var a=arguments,i=function(){var E=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,l=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,L=/[^-+\dA-Z]/g;return function(r,p,g,d){if(a.length===1&&C(r)==="string"&&!/\d/.test(r)&&(p=r,r=void 0),r=r||r===0?r:new Date,r instanceof Date||(r=new Date(r)),isNaN(r))throw TypeError("Invalid date");p=String(i.masks[p]||p||i.masks.default);var b=p.slice(0,4);(b==="UTC:"||b==="GMT:")&&(p=p.slice(4),g=!0,b==="GMT:"&&(d=!0));var _=e(function(){return g?"getUTC":"get"},"_2"),w=e(function(){return r[_()+"Date"]()},"d"),M=e(function(){return r[_()+"Day"]()},"D2"),m=e(function(){return r[_()+"Month"]()},"m"),v=e(function(){return r[_()+"FullYear"]()},"y2"),j=e(function(){return r[_()+"Hours"]()},"H"),T=e(function(){return r[_()+"Minutes"]()},"M"),R=e(function(){return r[_()+"Seconds"]()},"s"),F=e(function(){return r[_()+"Milliseconds"]()},"L"),I=e(function(){return g?0:r.getTimezoneOffset()},"o"),K=e(function(){return O(r)},"W"),q=e(function(){return h(r)},"N"),V={d:e(function(){return w()},"d"),dd:e(function(){return u(w())},"dd"),ddd:e(function(){return i.i18n.dayNames[M()]},"ddd"),DDD:e(function(){return f({y:v(),m:m(),d:w(),_:_(),dayName:i.i18n.dayNames[M()],short:!0})},"DDD"),dddd:e(function(){return i.i18n.dayNames[M()+7]},"dddd"),DDDD:e(function(){return f({y:v(),m:m(),d:w(),_:_(),dayName:i.i18n.dayNames[M()+7]})},"DDDD"),m:e(function(){return m()+1},"m"),mm:e(function(){return u(m()+1)},"mm"),mmm:e(function(){return i.i18n.monthNames[m()]},"mmm"),mmmm:e(function(){return i.i18n.monthNames[m()+12]},"mmmm"),yy:e(function(){return String(v()).slice(2)},"yy"),yyyy:e(function(){return u(v(),4)},"yyyy"),h:e(function(){return j()%12||12},"h"),hh:e(function(){return u(j()%12||12)},"hh"),H:e(function(){return j()},"H"),HH:e(function(){return u(j())},"HH"),M:e(function(){return T()},"M"),MM:e(function(){return u(T())},"MM"),s:e(function(){return R()},"s"),ss:e(function(){return u(R())},"ss"),l:e(function(){return u(F(),3)},"l"),L:e(function(){return u(Math.floor(F()/10))},"L"),t:e(function(){return j()<12?i.i18n.timeNames[0]:i.i18n.timeNames[1]},"t"),tt:e(function(){return j()<12?i.i18n.timeNames[2]:i.i18n.timeNames[3]},"tt"),T:e(function(){return j()<12?i.i18n.timeNames[4]:i.i18n.timeNames[5]},"T"),TT:e(function(){return j()<12?i.i18n.timeNames[6]:i.i18n.timeNames[7]},"TT"),Z:e(function(){return d?"GMT":g?"UTC":(String(r).match(l)||[""]).pop().replace(L,"").replace(/GMT\+0000/g,"UTC")},"Z"),o:e(function(){return(I()>0?"-":"+")+u(Math.floor(Math.abs(I())/60)*100+Math.abs(I())%60,4)},"o"),p:e(function(){return(I()>0?"-":"+")+u(Math.floor(Math.abs(I())/60),2)+":"+u(Math.floor(Math.abs(I())%60),2)},"p"),S:e(function(){return["th","st","nd","rd"][w()%10>3?0:(w()%100-w()%10!=10)*w()%10]},"S"),W:e(function(){return K()},"W"),WW:e(function(){return u(K())},"WW"),N:e(function(){return q()},"N")};return p.replace(E,function(S){return S in V?V[S]():S.slice(1,S.length-1)})}}();i.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},i.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]};var u=e(function(l,L){for(l=String(l),L=L||2;l.length<L;)l="0"+l;return l},"pad2"),f=e(function(l){var L=l.y,r=l.m,p=l.d,g=l._,d=l.dayName,b=l.short,_=b===void 0?!1:b,w=new Date,M=new Date;M.setDate(M[g+"Date"]()-1);var m=new Date;m.setDate(m[g+"Date"]()+1);var v=e(function(){return w[g+"Date"]()},"today_d2"),j=e(function(){return w[g+"Month"]()},"today_m2"),T=e(function(){return w[g+"FullYear"]()},"today_y2"),R=e(function(){return M[g+"Date"]()},"yesterday_d2"),F=e(function(){return M[g+"Month"]()},"yesterday_m2"),I=e(function(){return M[g+"FullYear"]()},"yesterday_y2"),K=e(function(){return m[g+"Date"]()},"tomorrow_d2"),q=e(function(){return m[g+"Month"]()},"tomorrow_m2"),V=e(function(){return m[g+"FullYear"]()},"tomorrow_y2");return T()===L&&j()===r&&v()===p?_?"Tdy":"Today":I()===L&&F()===r&&R()===p?_?"Ysd":"Yesterday":V()===L&&q()===r&&K()===p?_?"Tmw":"Tomorrow":d},"getDayName2"),O=e(function(l){var L=new Date(l.getFullYear(),l.getMonth(),l.getDate());L.setDate(L.getDate()-(L.getDay()+6)%7+3);var r=new Date(L.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var p=L.getTimezoneOffset()-r.getTimezoneOffset();L.setHours(L.getHours()-p);var g=(L-r)/(864e5*7);return 1+Math.floor(g)},"getWeek2"),h=e(function(l){var L=l.getDay();return L===0&&(L=7),L},"getDayOfWeek2"),C=e(function(l){return l===null?"null":l===void 0?"undefined":s(l)!=="object"?s(l):Array.isArray(l)?"array":{}.toString.call(l).slice(8,-1).toLowerCase()},"kindOf2");typeof define=="function"&&define.amd?define(function(){return i}):(typeof o>"u"?"undefined":s(o))==="object"?n.exports=i:c.dateFormat=i}(void 0)}}),Se=A({"lib/utils/is-valid-date.js"(o,n){"use strict";n.exports=s;function s(c){return c instanceof Date&&!Number.isNaN(c.getTime())}e(s,"isValidDate")}}),qe=A({"lib/utils/create-date.js"(o,n){"use strict";n.exports=c;var s=Se();function c(a){let i=new Date(a);return s(i)||(i=new Date(+a)),i}e(c,"createDate")}}),He=A({"lib/utils/format-time.js"(o,n){"use strict";n.exports=f;var{DATE_FORMAT:s,DATE_FORMAT_SIMPLE:c}=re(),a=$e(),i=qe(),u=Se();function f(O,h=!1){if(h===!1)return O;let C=i(O);if(!u(C))return O;if(h===!0)return a(C,c);let E=h.toUpperCase();if(E==="SYS:STANDARD")return a(C,s);let l=E.substr(0,4);return l==="SYS:"||l==="UTC:"?l==="UTC:"?a(C,h):a(C,h.slice(4)):a(C,`UTC:${h}`)}e(f,"formatTime")}}),Ve=A({"lib/utils/prettify-time.js"(o,n){"use strict";n.exports=c;var s=He();function c({log:a,context:i}){let{timestampKey:u,translateTime:f}=i,O=i.customPrettifiers?.time,h=null;if(u in a?h=a[u]:"timestamp"in a&&(h=a.timestamp),h===null)return;let C=f?s(h,f):h;return O?O(C):`[${C}]`}e(c,"prettifyTime")}}),We=A({"node_modules/fast-copy/dist/cjs/index.cjs"(o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=Function.prototype.toString,s=Object.create,c=Object.prototype.toString,a=function(){function t(){this._keys=[],this._values=[]}return e(t,"LegacyCache2"),t.prototype.has=function(y){return!!~this._keys.indexOf(y)},t.prototype.get=function(y){return this._values[this._keys.indexOf(y)]},t.prototype.set=function(y,D){this._keys.push(y),this._values.push(D)},t}();function i(){return new a}e(i,"createCacheLegacy");function u(){return new WeakMap}e(u,"createCacheModern");var f=typeof WeakMap<"u"?u:i;function O(t){if(!t)return s(null);var y=t.constructor;if(y===Object)return t===Object.prototype?{}:s(t);if(~n.call(y).indexOf("[native code]"))try{return new y}catch{}return s(t)}e(O,"getCleanClone");function h(t){var y="";return t.global&&(y+="g"),t.ignoreCase&&(y+="i"),t.multiline&&(y+="m"),t.unicode&&(y+="u"),t.sticky&&(y+="y"),y}e(h,"getRegExpFlagsLegacy");function C(t){return t.flags}e(C,"getRegExpFlagsModern");var E=/test/g.flags==="g"?C:h;function l(t){var y=c.call(t);return y.substring(8,y.length-1)}e(l,"getTagLegacy");function L(t){return t[Symbol.toStringTag]||l(t)}e(L,"getTagModern");var r=typeof Symbol<"u"?L:l,p=Object.defineProperty,g=Object.getOwnPropertyDescriptor,d=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,_=Object.prototype,w=_.hasOwnProperty,M=_.propertyIsEnumerable,m=typeof b=="function";function v(t){return d(t).concat(b(t))}e(v,"getStrictPropertiesModern");var j=m?v:d;function T(t,y,D){for(var P=j(t),$=0,x=P.length,N=void 0,B=void 0;$<x;++$)if(N=P[$],!(N==="callee"||N==="caller")){if(B=g(t,N),!B){y[N]=D.copier(t[N],D);continue}!B.get&&!B.set&&(B.value=D.copier(B.value,D));try{p(y,N,B)}catch{y[N]=B.value}}return y}e(T,"copyOwnPropertiesStrict");function R(t,y){var D=new y.Constructor;y.cache.set(t,D);for(var P=0,$=t.length;P<$;++P)D[P]=y.copier(t[P],y);return D}e(R,"copyArrayLoose");function F(t,y){var D=new y.Constructor;return y.cache.set(t,D),T(t,D,y)}e(F,"copyArrayStrict");function I(t,y){return t.slice(0)}e(I,"copyArrayBuffer");function K(t,y){return t.slice(0,t.size,t.type)}e(K,"copyBlob");function q(t,y){return new y.Constructor(I(t.buffer))}e(q,"copyDataView");function V(t,y){return new y.Constructor(t.getTime())}e(V,"copyDate");function S(t,y){var D=new y.Constructor;return y.cache.set(t,D),t.forEach(function(P,$){D.set($,y.copier(P,y))}),D}e(S,"copyMapLoose");function Z(t,y){return T(t,S(t,y),y)}e(Z,"copyMapStrict");function G(t,y){var D=O(y.prototype);y.cache.set(t,D);for(var P in t)w.call(t,P)&&(D[P]=y.copier(t[P],y));return D}e(G,"copyObjectLooseLegacy");function X(t,y){var D=O(y.prototype);y.cache.set(t,D);for(var P in t)w.call(t,P)&&(D[P]=y.copier(t[P],y));for(var $=b(t),x=0,N=$.length,B=void 0;x<N;++x)B=$[x],M.call(t,B)&&(D[B]=y.copier(t[B],y));return D}e(X,"copyObjectLooseModern");var te=m?X:G;function z(t,y){var D=O(y.prototype);return y.cache.set(t,D),T(t,D,y)}e(z,"copyObjectStrict");function Y(t,y){return new y.Constructor(t.valueOf())}e(Y,"copyPrimitiveWrapper");function ue(t,y){var D=new y.Constructor(t.source,E(t));return D.lastIndex=t.lastIndex,D}e(ue,"copyRegExp");function k(t,y){return t}e(k,"copySelf");function ne(t,y){var D=new y.Constructor;return y.cache.set(t,D),t.forEach(function(P){D.add(y.copier(P,y))}),D}e(ne,"copySetLoose");function ce(t,y){return T(t,ne(t,y),y)}e(ce,"copySetStrict");var fe=Array.isArray,Q=Object.assign,le=Object.getPrototypeOf||function(t){return t.__proto__},ie={array:R,arrayBuffer:I,blob:K,dataView:q,date:V,error:k,map:S,object:te,regExp:ue,set:ne},ye=Q({},ie,{array:F,map:Z,object:z,set:ce});function de(t){return{Arguments:t.object,Array:t.array,ArrayBuffer:t.arrayBuffer,Blob:t.blob,Boolean:Y,DataView:t.dataView,Date:t.date,Error:t.error,Float32Array:t.arrayBuffer,Float64Array:t.arrayBuffer,Int8Array:t.arrayBuffer,Int16Array:t.arrayBuffer,Int32Array:t.arrayBuffer,Map:t.map,Number:Y,Object:t.object,Promise:k,RegExp:t.regExp,Set:t.set,String:Y,WeakMap:k,WeakSet:k,Uint8Array:t.arrayBuffer,Uint8ClampedArray:t.arrayBuffer,Uint16Array:t.arrayBuffer,Uint32Array:t.arrayBuffer,Uint64Array:t.arrayBuffer}}e(de,"getTagSpecificCopiers");function ee(t){var y=Q({},ie,t),D=de(y),P=D.Array,$=D.Object;function x(N,B){if(B.prototype=B.Constructor=void 0,!N||typeof N!="object")return N;if(B.cache.has(N))return B.cache.get(N);if(B.prototype=le(N),B.Constructor=B.prototype&&B.prototype.constructor,!B.Constructor||B.Constructor===Object)return $(N,B);if(fe(N))return P(N,B);var H=D[r(N)];return H?H(N,B):typeof N.then=="function"?N:$(N,B)}return e(x,"copier"),e(function(B){return x(B,{Constructor:void 0,cache:f(),copier:x,prototype:void 0})},"copy")}e(ee,"createCopier");function oe(t){return ee(Q({},ye,t))}e(oe,"createStrictCopier");var me=oe({}),pe=ee({});o.copyStrict=me,o.createCopier=ee,o.createStrictCopier=oe,o.default=pe}}),Ue=A({"lib/utils/delete-log-property.js"(o,n){"use strict";n.exports=a;var s=se(),c=Le();function a(i,u){let f=c(u),O=f.pop();i=s(i,f),i!==null&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,O)&&delete i[O]}e(a,"deleteLogProperty")}}),Ge=A({"lib/utils/filter-log.js"(o,n){"use strict";n.exports=i;var{createCopier:s}=We(),c=s({}),a=Ue();function i({log:u,context:f}){let{ignoreKeys:O,includeKeys:h}=f,C=c(u);if(h){let E={};return h.forEach(l=>{E[l]=C[l]}),E}return O.forEach(E=>{a(C,E)}),C}e(i,"filterLog")}}),Ye=A({"lib/pretty.js"(o,n){n.exports=p;var s=Ne(),c=Oe(),a=xe(),i=Re(),u=Ie(),f=Ke(),O=Ee(),h=Ve(),C=Ge(),{LEVELS:E,LEVEL_KEY:l,LEVEL_NAMES:L}=re(),r=e(g=>{try{return{value:s.parse(g,{protoAction:"remove"})}}catch(d){return{err:d}}},"jsonParser");function p(g){let d;if(c(g))d=g;else{let v=r(g);if(v.err||!c(v.value))return g+this.EOL;d=v.value}if(this.minimumLevel){let v;this.useOnlyCustomProps?v=this.customLevels:v=this.customLevelNames[this.minimumLevel]!==void 0;let j;if(v?j=this.customLevelNames[this.minimumLevel]:j=L[this.minimumLevel],j||(j=typeof this.minimumLevel=="string"?L[this.minimumLevel]:L[E[this.minimumLevel].toLowerCase()]),d[this.levelKey===void 0?l:this.levelKey]<j)return}let b=u({log:d,context:this.context});(this.ignoreKeys||this.includeKeys)&&(d=C({log:d,context:this.context}));let _=i({log:d,context:{...this.context,...this.context.customProperties}}),w=f({log:d,context:this.context}),M=h({log:d,context:this.context}),m="";if(this.levelFirst&&_&&(m=`${_}`),M&&m===""?m=`${M}`:M&&(m=`${m} ${M}`),!this.levelFirst&&_&&(m.length>0?m=`${m} ${_}`:m=_),w&&(m.length>0?m=`${m} ${w}:`:m=w),m.endsWith(":")===!1&&m!==""&&(m+=":"),b!==void 0&&(m.length>0?m=`${m} ${b}`:m=b),m.length>0&&!this.singleLine&&(m+=this.EOL),d.type==="Error"&&d.stack){let v=a({log:d,context:this.context});this.singleLine&&(m+=this.EOL),m+=v}else if(this.hideObject===!1){let v=[this.messageKey,this.levelKey,this.timestampKey].filter(T=>typeof d[T]=="string"||typeof d[T]=="number"||typeof d[T]=="boolean"),j=O({log:d,skipKeys:v,context:this.context});this.singleLine&&!/^\s$/.test(j)&&(m+=" "),m+=j}return m}e(p,"pretty")}}),Me=Ye();var ze=Object.getOwnPropertyNames;var J=e((o,n)=>e(function(){return n||(0,o[ze(o)[0]])((n={exports:{}}).exports,n),n.exports},"__require2"),"__commonJS"),Ce=J({"lib/constants.js"(o,n){"use strict";n.exports={DATE_FORMAT:"yyyy-mm-dd HH:MM:ss.l o",DATE_FORMAT_SIMPLE:"HH:MM:ss.l",ERROR_LIKE_KEYS:["err","error"],MESSAGE_KEY:"msg",LEVEL_KEY:"level",LEVEL_LABEL:"levelLabel",TIMESTAMP_KEY:"time",LEVELS:{default:"USERLVL",60:"FATAL",50:"ERROR",40:"WARN",30:"INFO",20:"DEBUG",10:"TRACE"},LEVEL_NAMES:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},LOGGER_KEYS:["pid","hostname","name","level","time","timestamp","caller"]}}}),ke=J({"node_modules/colorette/index.cjs"(o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var{env:n={},argv:s=[],platform:c=""}=typeof process>"u"?{}:process,a="NO_COLOR"in n||s.includes("--no-color"),i="FORCE_COLOR"in n||s.includes("--color"),u=c==="win32",f=n.TERM==="dumb",O=globalThis.Deno&&globalThis.Deno.isatty(1)&&n.TERM&&!f,h="CI"in n&&("GITHUB_ACTIONS"in n||"GITLAB_CI"in n||"CIRCLECI"in n),C=!a&&(i||u&&!f||O||h),E=e((x,N,B,H,W=N.substring(0,x)+H,ge=N.substring(x+B.length),_e=ge.indexOf(B))=>W+(_e<0?ge:E(_e,ge,B,H)),"replaceClose"),l=e((x,N,B,H,W)=>x<0?B+N+H:B+E(x,N,H,W)+H,"clearBleed"),L=e((x,N,B=x,H=x.length+1)=>W=>W||!(W===""||W===void 0)?l((""+W).indexOf(N,H),W,x,N,B):"","filterEmpty"),r=e((x,N,B)=>L(`\x1B[${x}m`,`\x1B[${N}m`,B),"init"),p={reset:r(0,0),bold:r(1,22,"\x1B[22m\x1B[1m"),dim:r(2,22,"\x1B[22m\x1B[2m"),italic:r(3,23),underline:r(4,24),inverse:r(7,27),hidden:r(8,28),strikethrough:r(9,29),black:r(30,39),red:r(31,39),green:r(32,39),yellow:r(33,39),blue:r(34,39),magenta:r(35,39),cyan:r(36,39),white:r(37,39),gray:r(90,39),bgBlack:r(40,49),bgRed:r(41,49),bgGreen:r(42,49),bgYellow:r(43,49),bgBlue:r(44,49),bgMagenta:r(45,49),bgCyan:r(46,49),bgWhite:r(47,49),blackBright:r(90,39),redBright:r(91,39),greenBright:r(92,39),yellowBright:r(93,39),blueBright:r(94,39),magentaBright:r(95,39),cyanBright:r(96,39),whiteBright:r(97,39),bgBlackBright:r(100,49),bgRedBright:r(101,49),bgGreenBright:r(102,49),bgYellowBright:r(103,49),bgBlueBright:r(104,49),bgMagentaBright:r(105,49),bgCyanBright:r(106,49),bgWhiteBright:r(107,49)},g=e(({useColor:x=C}={})=>x?p:Object.keys(p).reduce((N,B)=>({...N,[B]:String}),{}),"createColors"),{reset:d,bold:b,dim:_,italic:w,underline:M,inverse:m,hidden:v,strikethrough:j,black:T,red:R,green:F,yellow:I,blue:K,magenta:q,cyan:V,white:S,gray:Z,bgBlack:G,bgRed:X,bgGreen:te,bgYellow:z,bgBlue:Y,bgMagenta:ue,bgCyan:k,bgWhite:ne,blackBright:ce,redBright:fe,greenBright:Q,yellowBright:le,blueBright:ie,magentaBright:ye,cyanBright:de,whiteBright:ee,bgBlackBright:oe,bgRedBright:me,bgGreenBright:pe,bgYellowBright:t,bgBlueBright:y,bgMagentaBright:D,bgCyanBright:P,bgWhiteBright:$}=g();o.bgBlack=G,o.bgBlackBright=oe,o.bgBlue=Y,o.bgBlueBright=y,o.bgCyan=k,o.bgCyanBright=P,o.bgGreen=te,o.bgGreenBright=pe,o.bgMagenta=ue,o.bgMagentaBright=D,o.bgRed=X,o.bgRedBright=me,o.bgWhite=ne,o.bgWhiteBright=$,o.bgYellow=z,o.bgYellowBright=t,o.black=T,o.blackBright=ce,o.blue=K,o.blueBright=ie,o.bold=b,o.createColors=g,o.cyan=V,o.cyanBright=de,o.dim=_,o.gray=Z,o.green=F,o.greenBright=Q,o.hidden=v,o.inverse=m,o.isColorSupported=C,o.italic=w,o.magenta=q,o.magentaBright=ye,o.red=R,o.redBright=fe,o.reset=d,o.strikethrough=j,o.underline=M,o.white=S,o.whiteBright=ee,o.yellow=I,o.yellowBright=le}}),Je=J({"lib/colors.js"(o,n){"use strict";var{LEVELS:s,LEVEL_NAMES:c}=Ce(),a=e(m=>m,"nocolor"),i={default:a,60:a,50:a,40:a,30:a,20:a,10:a,message:a,greyMessage:a},{createColors:u}=ke(),f=u({useColor:!0}),{white:O,bgRed:h,red:C,yellow:E,green:l,blue:L,gray:r,cyan:p}=f,g={default:O,60:h,50:C,40:E,30:l,20:L,10:r,message:p,greyMessage:r};function d(m){return m.reduce(function(v,[j,T]){return v[j]=typeof f[T]=="function"?f[T]:O,v},{default:O,message:p,greyMessage:r})}e(d,"resolveCustomColoredColorizer");function b(m){return function(v,j,{customLevels:T,customLevelNames:R}={}){let F=m?T||s:Object.assign({},s,T),I=m?R||c:Object.assign({},c,R),K="default";Number.isInteger(+v)?K=Object.prototype.hasOwnProperty.call(F,v)?v:K:K=Object.prototype.hasOwnProperty.call(I,v.toLowerCase())?I[v.toLowerCase()]:K;let q=F[K];return Object.prototype.hasOwnProperty.call(j,K)?j[K](q):j.default(q)}}e(b,"colorizeLevel");function _(m){let v=b(m),j=e(function(T,R){return v(T,i,R)},"customColoredColorizer");return j.message=i.message,j.greyMessage=i.greyMessage,j}e(_,"plainColorizer");function w(m){let v=b(m),j=e(function(T,R){return v(T,g,R)},"customColoredColorizer");return j.message=g.message,j.greyMessage=g.greyMessage,j}e(w,"coloredColorizer");function M(m,v){let j=d(m),T=v?j:Object.assign({},g,j),R=b(v),F=e(function(I,K){return R(I,T,K)},"customColoredColorizer");return F.message=F.message||T.message,F.greyMessage=F.greyMessage||T.greyMessage,F}e(M,"customColoredColorizerFactory"),n.exports=e(function(v=!1,j,T){return v&&j!==void 0?M(j,T):v?w(T):_(T)},"getColorizer")}}),Ze=J({"lib/utils/handle-custom-levels-opts.js"(o,n){"use strict";n.exports=s;function s(c){return c?typeof c=="string"?c.split(",").reduce((a,i,u)=>{let[f,O=u]=i.split(":");return a[O]=f.toUpperCase(),a},{default:"USERLVL"}):Object.prototype.toString.call(c)==="[object Object]"?Object.keys(c).reduce((a,i)=>(a[c[i]]=i.toUpperCase(),a),{default:"USERLVL"}):{}:{}}e(s,"handleCustomLevelsOpts")}}),Xe=J({"lib/utils/handle-custom-levels-names-opts.js"(o,n){"use strict";n.exports=s;function s(c){return c?typeof c=="string"?c.split(",").reduce((a,i,u)=>{let[f,O=u]=i.split(":");return a[f.toLowerCase()]=O,a},{}):Object.prototype.toString.call(c)==="[object Object]"?Object.keys(c).reduce((a,i)=>(a[i.toLowerCase()]=c[i],a),{}):{}:{}}e(s,"handleCustomLevelsNamesOpts")}}),Qe=J({"lib/utils/parse-factory-options.js"(o,n){n.exports=u;var{LEVEL_NAMES:s}=Ce(),c=Je(),a=Ze(),i=Xe();function u(f){let O=f.crlf?`\r
`:`
`,h="    ",{customPrettifiers:C,errorLikeObjectKeys:E,hideObject:l,levelFirst:L,levelKey:r,levelLabel:p,messageFormat:g,messageKey:d,minimumLevel:b,singleLine:_,timestampKey:w,translateTime:M}=f,m=f.errorProps.split(","),v=typeof f.useOnlyCustomProps=="boolean"?f.useOnlyCustomProps:f.useOnlyCustomProps==="true",j=a(f.customLevels),T=i(f.customLevels),R;f.customColors&&(R=f.customColors.split(",").reduce((S,Z)=>{let[G,X]=Z.split(":"),z=(v?f.customLevels:T[G]!==void 0)?T[G]:s[G],Y=z!==void 0?z:G;return S.push([Y,X]),S},[]));let F={customLevels:j,customLevelNames:T};v===!0&&!f.customLevels&&(F.customLevels=void 0,F.customLevelNames=void 0);let I=f.include!==void 0?new Set(f.include.split(",")):void 0,K=!I&&f.ignore?new Set(f.ignore.split(",")):void 0,q=c(f.colorize,R,v),V=f.colorizeObjects?q:c(!1,[],!1);return{EOL:O,IDENT:h,colorizer:q,customColors:R,customLevelNames:T,customLevels:j,customPrettifiers:C,customProperties:F,errorLikeObjectKeys:E,errorProps:m,hideObject:l,ignoreKeys:K,includeKeys:I,levelFirst:L,levelKey:r,levelLabel:p,messageFormat:g,messageKey:d,minimumLevel:b,objectColorizer:V,singleLine:_,timestampKey:w,translateTime:M,useOnlyCustomProps:v}}e(u,"parseFactoryOptions")}}),je=Qe();var er={colorize:!0,colorizeObjects:!0,crlf:!1,customColors:null,customLevels:null,customPrettifiers:{},errorLikeObjectKeys:["err","error"],errorProps:"",hideObject:!1,ignore:"hostname",include:void 0,levelFirst:!1,levelKey:"level",levelLabel:"levelLabel",messageFormat:null,messageKey:"msg",minimumLevel:void 0,outputStream:console,singleLine:!1,timestampKey:"timestamp",translateTime:"SYS:HH:MM:ss",useOnlyCustomProps:!0};function rr(o){let n=je(Object.assign({},er,o));return Me.bind({...n,context:n})}e(rr,"prettyFactory");var we=rr({customPrettifiers:{time:o=>`${o}`}}),ae=class extends U.handlers.BaseHandler{static{e(this,"ConsoleHandler")}format(n){try{let s=JSON.parse(n.msg);return s.level=n.levelName,s.timestamp||(s.timestamp=n.datetime),delete s.hostname,we(s)}catch{return we({level:n.levelName,timestamp:n.datetime,msg:n.msg})}}log(n){console.log(n)}};await U.setup({handlers:{console:new ae("DEBUG")},loggers:{default:{level:"DEBUG",handlers:["console"]}}});var ve=class{static{e(this,"DefaultConsoleAdapter")}debug(...n){n.forEach(s=>{console.debug(JSON.stringify(s))})}info(...n){n.forEach(s=>{console.info(JSON.stringify(s))})}log(...n){n.forEach(s=>{console.log(JSON.stringify(s))})}warn(...n){n.forEach(s=>{console.warn(JSON.stringify(s))})}error(...n){n.forEach(s=>{console.error(JSON.stringify(s))})}},be=class{static{e(this,"LocalConsoleAdapter")}debug(...n){n.forEach(s=>{U.debug(s)})}info(...n){n.forEach(s=>{U.info(s)})}log(...n){n.forEach(s=>{U.info(s)})}warn(...n){n.forEach(s=>{U.warning(s)})}error(...n){n.forEach(s=>{U.error(s)})}},ut=new ve,Te=new be;var tr="system-logger";globalThis.__ZUPLO_SERVICE_PROVIDER&&globalThis.__ZUPLO_SERVICE_PROVIDER.addService(tr,{logger:Te,captureUserLogs:!0});export{tr as SYSTEM_LOGGER};
