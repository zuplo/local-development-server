var Ne=Object.defineProperty;var e=(a,t)=>Ne(a,"name",{value:t,configurable:!0});import{bundle as sr,transpile as ar}from"https://deno.land/x/emit@0.29.0/mod.ts";import{load as cr}from"https://deno.land/std@0.203.0/dotenv/mod.ts";import{createOAuth2Token as fr}from"https://deno.land/x/deno_gcp_admin@0.0.5/auth.ts";import{parse as mr}from"https://deno.land/std@0.203.0/flags/mod.ts";import{Server as pr}from"https://deno.land/std@0.203.0/http/server.ts";import*as gr from"https://deno.land/std@0.203.0/fs/mod.ts";import*as hr from"https://deno.land/std@0.203.0/http/http_status.ts";import*as G from"https://deno.land/std@0.203.0/log/mod.ts";import*as vr from"https://deno.land/std@0.203.0/path/mod.ts";import{deferred as _r}from"https://deno.land/std@0.203.0/async/deferred.ts";import{assert as Er,assertAlmostEquals as Lr,assertArrayIncludes as Sr,assertEquals as Mr,assertExists as jr,assertFalse as Cr,assertInstanceOf as wr,assertIsError as Tr,assertMatch as Nr,assertNotEquals as Dr,assertNotMatch as Br,assertNotStrictEquals as Ar,assertObjectMatch as Pr,assertRejects as Rr,assertStrictEquals as xr,assertStringIncludes as Ir,assertThrows as Fr,equal as Kr,fail as $r,unimplemented as qr,unreachable as Wr}from"https://deno.land/std@0.203.0/assert/mod.ts";import{afterAll as Vr,afterEach as Gr,beforeAll as Ur,beforeEach as Yr,describe as zr,it as kr}from"https://deno.land/std@0.203.0/testing/bdd.ts";var De=Object.getOwnPropertyNames,P=e((a,t)=>e(function(){return t||(0,a[De(a)[0]])((t={exports:{}}).exports,t),t.exports},"__require"),"__commonJS"),Be=P({"node_modules/secure-json-parse/index.js"(a,t){"use strict";var o=typeof Buffer<"u",s=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,u=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function i(h,j,E){E==null&&j!==null&&typeof j=="object"&&(E=j,j=void 0),o&&Buffer.isBuffer(h)&&(h=h.toString()),h&&h.charCodeAt(0)===65279&&(h=h.slice(1));let f=JSON.parse(h,j);if(f===null||typeof f!="object")return f;let L=E&&E.protoAction||"error",r=E&&E.constructorAction||"error";if(L==="ignore"&&r==="ignore")return f;if(L!=="ignore"&&r!=="ignore"){if(s.test(h)===!1&&u.test(h)===!1)return f}else if(L!=="ignore"&&r==="ignore"){if(s.test(h)===!1)return f}else if(u.test(h)===!1)return f;return c(f,{protoAction:L,constructorAction:r,safe:E&&E.safe})}e(i,"_parse");function c(h,{protoAction:j="error",constructorAction:E="error",safe:f}={}){let L=[h];for(;L.length;){let r=L;L=[];for(let p of r){if(j!=="ignore"&&Object.prototype.hasOwnProperty.call(p,"__proto__")){if(f===!0)return null;if(j==="error")throw new SyntaxError("Object contains forbidden prototype property");delete p.__proto__}if(E!=="ignore"&&Object.prototype.hasOwnProperty.call(p,"constructor")&&Object.prototype.hasOwnProperty.call(p.constructor,"prototype")){if(f===!0)return null;if(E==="error")throw new SyntaxError("Object contains forbidden prototype property");delete p.constructor}for(let g in p){let m=p[g];m&&typeof m=="object"&&L.push(m)}}}return h}e(c,"filter");function l(h,j,E){let f=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(h,j,E)}finally{Error.stackTraceLimit=f}}e(l,"parse");function O(h,j){let E=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(h,j,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=E}}e(O,"safeParse"),t.exports=l,t.exports.default=l,t.exports.parse=l,t.exports.safeParse=O,t.exports.scan=c}}),Oe=P({"lib/utils/is-object.js"(a,t){"use strict";t.exports=o;function o(s){return Object.prototype.toString.apply(s)==="[object Object]"}e(o,"isObject")}}),re=P({"lib/constants.js"(a,t){"use strict";t.exports={DATE_FORMAT:"yyyy-mm-dd HH:MM:ss.l o",DATE_FORMAT_SIMPLE:"HH:MM:ss.l",ERROR_LIKE_KEYS:["err","error"],MESSAGE_KEY:"msg",LEVEL_KEY:"level",LEVEL_LABEL:"levelLabel",TIMESTAMP_KEY:"time",LEVELS:{default:"USERLVL",60:"FATAL",50:"ERROR",40:"WARN",30:"INFO",20:"DEBUG",10:"TRACE"},LEVEL_NAMES:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},LOGGER_KEYS:["pid","hostname","name","level","time","timestamp","caller"]}}}),he=P({"lib/utils/join-lines-with-indentation.js"(a,t){"use strict";t.exports=o;function o({input:s,ident:u="    ",eol:i=`
`}){let c=s.split(/\r?\n/);for(let l=1;l<c.length;l+=1)c[l]=u+c[l];return c.join(i)}e(o,"joinLinesWithIndentation")}}),Ae=P({"node_modules/fast-safe-stringify/index.js"(a,t){t.exports=l,l.default=l,l.stable=E,l.stableStringify=E;var o="[...]",s="[Circular]",u=[],i=[];function c(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}e(c,"defaultOptions");function l(r,p,g,m){typeof m>"u"&&(m=c()),h(r,"",0,[],void 0,0,m);var b;try{i.length===0?b=JSON.stringify(r,p,g):b=JSON.stringify(r,L(p),g)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;u.length!==0;){var _=u.pop();_.length===4?Object.defineProperty(_[0],_[1],_[3]):_[0][_[1]]=_[2]}}return b}e(l,"stringify");function O(r,p,g,m){var b=Object.getOwnPropertyDescriptor(m,g);b.get!==void 0?b.configurable?(Object.defineProperty(m,g,{value:r}),u.push([m,g,p,b])):i.push([p,g,r]):(m[g]=r,u.push([m,g,p]))}e(O,"setReplace");function h(r,p,g,m,b,_,w){_+=1;var M;if(typeof r=="object"&&r!==null){for(M=0;M<m.length;M++)if(m[M]===r){O(s,r,p,b);return}if(typeof w.depthLimit<"u"&&_>w.depthLimit){O(o,r,p,b);return}if(typeof w.edgesLimit<"u"&&g+1>w.edgesLimit){O(o,r,p,b);return}if(m.push(r),Array.isArray(r))for(M=0;M<r.length;M++)h(r[M],M,M,m,r,_,w);else{var d=Object.keys(r);for(M=0;M<d.length;M++){var v=d[M];h(r[v],v,M,m,r,_,w)}}m.pop()}}e(h,"decirc");function j(r,p){return r<p?-1:r>p?1:0}e(j,"compareFunction");function E(r,p,g,m){typeof m>"u"&&(m=c());var b=f(r,"",0,[],void 0,0,m)||r,_;try{i.length===0?_=JSON.stringify(b,p,g):_=JSON.stringify(b,L(p),g)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;u.length!==0;){var w=u.pop();w.length===4?Object.defineProperty(w[0],w[1],w[3]):w[0][w[1]]=w[2]}}return _}e(E,"deterministicStringify");function f(r,p,g,m,b,_,w){_+=1;var M;if(typeof r=="object"&&r!==null){for(M=0;M<m.length;M++)if(m[M]===r){O(s,r,p,b);return}try{if(typeof r.toJSON=="function")return}catch{return}if(typeof w.depthLimit<"u"&&_>w.depthLimit){O(o,r,p,b);return}if(typeof w.edgesLimit<"u"&&g+1>w.edgesLimit){O(o,r,p,b);return}if(m.push(r),Array.isArray(r))for(M=0;M<r.length;M++)f(r[M],M,M,m,r,_,w);else{var d={},v=Object.keys(r).sort(j);for(M=0;M<v.length;M++){var C=v[M];f(r[C],C,M,m,r,_,w),d[C]=r[C]}if(typeof b<"u")u.push([b,p,r]),b[p]=d;else return d}m.pop()}}e(f,"deterministicDecirc");function L(r){return r=typeof r<"u"?r:function(p,g){return g},function(p,g){if(i.length>0)for(var m=0;m<i.length;m++){var b=i[m];if(b[1]===p&&b[0]===g){g=b[2],i.splice(m,1);break}}return r.call(this,p,g)}}e(L,"replaceGetterValues")}}),Pe=P({"lib/utils/prettify-error.js"(a,t){"use strict";t.exports=s;var o=he();function s({keyName:u,lines:i,eol:c,ident:l}){let O="",h=o({input:i,ident:l,eol:c}),j=`${l}${u}: ${h}${c}`.split(c);for(let E=0;E<j.length;E+=1){E!==0&&(O+=c);let f=j[E];if(/^\s*"stack"/.test(f)){let L=/^(\s*"stack":)\s*(".*"),?$/.exec(f);if(L&&L.length===3){let r=/^\s*/.exec(f)[0].length+4,p=" ".repeat(r),g=L[2];O+=L[1]+c+p+JSON.parse(g).replace(/\n/g,c+p)}else O+=f}else O+=f}return O}e(s,"prettifyError")}}),Ee=P({"lib/utils/prettify-object.js"(a,t){"use strict";t.exports=c;var{LOGGER_KEYS:o}=re(),s=Ae(),u=he(),i=Pe();function c({log:l,excludeLoggerKeys:O=!0,skipKeys:h=[],context:j}){let{EOL:E,IDENT:f,customPrettifiers:L,errorLikeObjectKeys:r,objectColorizer:p,singleLine:g}=j,m=[].concat(h);O===!0&&Array.prototype.push.apply(m,o);let b="",{plain:_,errors:w}=Object.entries(l).reduce(({plain:M,errors:d},[v,C])=>{if(m.includes(v)===!1){let T=typeof L[v]=="function"?L[v](C,v,l):C;r.includes(v)?d[v]=T:M[v]=T}return{plain:M,errors:d}},{plain:{},errors:{}});return g?(Object.keys(_).length>0&&(b+=p.greyMessage(s(_))),b+=E,b=b.replace(/\\\\/gi,"\\")):Object.entries(_).forEach(([M,d])=>{let v=typeof L[M]=="function"?d:s(d,null,2);if(v===void 0)return;v=v.replace(/\\\\/gi,"\\");let C=u({input:v,ident:f,eol:E});b+=`${f}${M}:${C.startsWith(E)?"":" "}${C}${E}`}),Object.entries(w).forEach(([M,d])=>{let v=typeof L[M]=="function"?d:s(d,null,2);v!==void 0&&(b+=i({keyName:M,lines:v,eol:E,ident:f}))}),b}e(c,"prettifyObject")}}),Re=P({"lib/utils/prettify-error-log.js"(a,t){"use strict";t.exports=c;var{LOGGER_KEYS:o}=re(),s=Oe(),u=he(),i=Ee();function c({log:l,context:O}){let{EOL:h,IDENT:j,errorProps:E,messageKey:f}=O,L=l.stack,r=u({input:L,ident:j,eol:h}),p=`${j}${r}${h}`;if(E.length>0){let g=o.concat(f,"type","stack"),m;E[0]==="*"?m=Object.keys(l).filter(b=>g.includes(b)===!1):m=E.filter(b=>g.includes(b)===!1);for(let b=0;b<m.length;b+=1){let _=m[b];if(_ in l){if(s(l[_])){let w=i({log:l[_],excludeLoggerKeys:!1,context:{...O,IDENT:j+j}});p=`${p}${j}${_}: {${h}${w}${j}}${h}`;continue}p=`${p}${j}${_}: ${l[_]}${h}`}}}return p}e(c,"prettifyErrorLog")}}),Le=P({"lib/utils/split-property-key.js"(a,t){"use strict";t.exports=o;function o(s){let u=[],i=!1,c="";for(let l=0;l<s.length;l++){let O=s.charAt(l);if(O==="\\"){i=!0;continue}if(i){i=!1,c+=O;continue}if(O==="."){u.push(c),c="";continue}c+=O}return c.length&&u.push(c),u}e(o,"splitPropertyKey")}}),se=P({"lib/utils/get-property-value.js"(a,t){"use strict";t.exports=s;var o=Le();function s(u,i){let c=Array.isArray(i)?i:o(i);for(let l of c){if(!Object.prototype.hasOwnProperty.call(u,l))return;u=u[l]}return u}e(s,"getPropertyValue")}}),xe=P({"lib/utils/prettify-level.js"(a,t){"use strict";t.exports=s;var o=se();function s({log:u,context:i}){let{colorizer:c,customLevels:l,customLevelNames:O,levelKey:h}=i,j=i.customPrettifiers?.level,E=o(u,h);if(E!==void 0)return j?j(E):c(E,{customLevels:l,customLevelNames:O})}e(s,"prettifyLevel")}}),Ie=P({"lib/utils/interpret-conditionals.js"(a,t){"use strict";t.exports=s;var o=se();function s(u,i){return u=u.replace(/{if (.*?)}(.*?){end}/g,c),u=u.replace(/{if (.*?)}/g,""),u=u.replace(/{end}/g,""),u.replace(/\s+/g," ").trim();function c(l,O,h){let j=o(i,O);return j&&h.includes(O)?h.replace(new RegExp("{"+O+"}","g"),j):""}e(c,"replacer")}e(s,"interpretConditionals")}}),Fe=P({"lib/utils/prettify-message.js"(a,t){"use strict";t.exports=i;var{LEVELS:o}=re(),s=se(),u=Ie();function i({log:c,context:l}){let{colorizer:O,customLevels:h,levelKey:j,levelLabel:E,messageFormat:f,messageKey:L,useOnlyCustomProps:r}=l;if(f&&typeof f=="string"){let p=u(f,c),g=String(p).replace(/{([^{}]+)}/g,function(m,b){let _;return b===E&&(_=s(c,j))!==void 0?(r?h===void 0:h[_]===void 0)?o[_]:h[_]:s(c,b)||""});return O.message(g)}if(f&&typeof f=="function"){let p=f(c,L,E);return O.message(p)}if(L in c&&!(typeof c[L]!="string"&&typeof c[L]!="number"&&typeof c[L]!="boolean"))return O.message(c[L])}e(i,"prettifyMessage")}}),Ke=P({"lib/utils/prettify-metadata.js"(a,t){"use strict";t.exports=o;function o({log:s,context:u}){let i=u.customPrettifiers,c="";if(s.name||s.pid||s.hostname){if(c+="(",s.name&&(c+=i.name?i.name(s.name):s.name),s.pid){let l=i.pid?i.pid(s.pid):s.pid;s.name&&s.pid?c+="/"+l:c+=l}s.hostname&&(c+=`${c==="("?"on":" on"} ${i.hostname?i.hostname(s.hostname):s.hostname}`),c+=")"}if(s.caller&&(c+=`${c===""?"":" "}<${i.caller?i.caller(s.caller):s.caller}>`),c!=="")return c}e(o,"prettifyMetadata")}}),$e=P({"node_modules/dateformat/lib/dateformat.js"(a,t){"use strict";function o(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=e(function(i){return typeof i},"_typeof2"):o=e(function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},"_typeof2"),o(s)}e(o,"_typeof"),function(s){var u=arguments,i=function(){var E=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,f=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,L=/[^-+\dA-Z]/g;return function(r,p,g,m){if(u.length===1&&j(r)==="string"&&!/\d/.test(r)&&(p=r,r=void 0),r=r||r===0?r:new Date,r instanceof Date||(r=new Date(r)),isNaN(r))throw TypeError("Invalid date");p=String(i.masks[p]||p||i.masks.default);var b=p.slice(0,4);(b==="UTC:"||b==="GMT:")&&(p=p.slice(4),g=!0,b==="GMT:"&&(m=!0));var _=e(function(){return g?"getUTC":"get"},"_2"),w=e(function(){return r[_()+"Date"]()},"d"),M=e(function(){return r[_()+"Day"]()},"D2"),d=e(function(){return r[_()+"Month"]()},"m"),v=e(function(){return r[_()+"FullYear"]()},"y2"),C=e(function(){return r[_()+"Hours"]()},"H"),T=e(function(){return r[_()+"Minutes"]()},"M"),x=e(function(){return r[_()+"Seconds"]()},"s"),I=e(function(){return r[_()+"Milliseconds"]()},"L"),F=e(function(){return g?0:r.getTimezoneOffset()},"o"),K=e(function(){return O(r)},"W"),q=e(function(){return h(r)},"N"),H={d:e(function(){return w()},"d"),dd:e(function(){return c(w())},"dd"),ddd:e(function(){return i.i18n.dayNames[M()]},"ddd"),DDD:e(function(){return l({y:v(),m:d(),d:w(),_:_(),dayName:i.i18n.dayNames[M()],short:!0})},"DDD"),dddd:e(function(){return i.i18n.dayNames[M()+7]},"dddd"),DDDD:e(function(){return l({y:v(),m:d(),d:w(),_:_(),dayName:i.i18n.dayNames[M()+7]})},"DDDD"),m:e(function(){return d()+1},"m"),mm:e(function(){return c(d()+1)},"mm"),mmm:e(function(){return i.i18n.monthNames[d()]},"mmm"),mmmm:e(function(){return i.i18n.monthNames[d()+12]},"mmmm"),yy:e(function(){return String(v()).slice(2)},"yy"),yyyy:e(function(){return c(v(),4)},"yyyy"),h:e(function(){return C()%12||12},"h"),hh:e(function(){return c(C()%12||12)},"hh"),H:e(function(){return C()},"H"),HH:e(function(){return c(C())},"HH"),M:e(function(){return T()},"M"),MM:e(function(){return c(T())},"MM"),s:e(function(){return x()},"s"),ss:e(function(){return c(x())},"ss"),l:e(function(){return c(I(),3)},"l"),L:e(function(){return c(Math.floor(I()/10))},"L"),t:e(function(){return C()<12?i.i18n.timeNames[0]:i.i18n.timeNames[1]},"t"),tt:e(function(){return C()<12?i.i18n.timeNames[2]:i.i18n.timeNames[3]},"tt"),T:e(function(){return C()<12?i.i18n.timeNames[4]:i.i18n.timeNames[5]},"T"),TT:e(function(){return C()<12?i.i18n.timeNames[6]:i.i18n.timeNames[7]},"TT"),Z:e(function(){return m?"GMT":g?"UTC":(String(r).match(f)||[""]).pop().replace(L,"").replace(/GMT\+0000/g,"UTC")},"Z"),o:e(function(){return(F()>0?"-":"+")+c(Math.floor(Math.abs(F())/60)*100+Math.abs(F())%60,4)},"o"),p:e(function(){return(F()>0?"-":"+")+c(Math.floor(Math.abs(F())/60),2)+":"+c(Math.floor(Math.abs(F())%60),2)},"p"),S:e(function(){return["th","st","nd","rd"][w()%10>3?0:(w()%100-w()%10!=10)*w()%10]},"S"),W:e(function(){return K()},"W"),WW:e(function(){return c(K())},"WW"),N:e(function(){return q()},"N")};return p.replace(E,function(S){return S in H?H[S]():S.slice(1,S.length-1)})}}();i.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},i.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]};var c=e(function(f,L){for(f=String(f),L=L||2;f.length<L;)f="0"+f;return f},"pad2"),l=e(function(f){var L=f.y,r=f.m,p=f.d,g=f._,m=f.dayName,b=f.short,_=b===void 0?!1:b,w=new Date,M=new Date;M.setDate(M[g+"Date"]()-1);var d=new Date;d.setDate(d[g+"Date"]()+1);var v=e(function(){return w[g+"Date"]()},"today_d2"),C=e(function(){return w[g+"Month"]()},"today_m2"),T=e(function(){return w[g+"FullYear"]()},"today_y2"),x=e(function(){return M[g+"Date"]()},"yesterday_d2"),I=e(function(){return M[g+"Month"]()},"yesterday_m2"),F=e(function(){return M[g+"FullYear"]()},"yesterday_y2"),K=e(function(){return d[g+"Date"]()},"tomorrow_d2"),q=e(function(){return d[g+"Month"]()},"tomorrow_m2"),H=e(function(){return d[g+"FullYear"]()},"tomorrow_y2");return T()===L&&C()===r&&v()===p?_?"Tdy":"Today":F()===L&&I()===r&&x()===p?_?"Ysd":"Yesterday":H()===L&&q()===r&&K()===p?_?"Tmw":"Tomorrow":m},"getDayName2"),O=e(function(f){var L=new Date(f.getFullYear(),f.getMonth(),f.getDate());L.setDate(L.getDate()-(L.getDay()+6)%7+3);var r=new Date(L.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var p=L.getTimezoneOffset()-r.getTimezoneOffset();L.setHours(L.getHours()-p);var g=(L-r)/(864e5*7);return 1+Math.floor(g)},"getWeek2"),h=e(function(f){var L=f.getDay();return L===0&&(L=7),L},"getDayOfWeek2"),j=e(function(f){return f===null?"null":f===void 0?"undefined":o(f)!=="object"?o(f):Array.isArray(f)?"array":{}.toString.call(f).slice(8,-1).toLowerCase()},"kindOf2");typeof define=="function"&&define.amd?define(function(){return i}):(typeof a>"u"?"undefined":o(a))==="object"?t.exports=i:s.dateFormat=i}(void 0)}}),Se=P({"lib/utils/is-valid-date.js"(a,t){"use strict";t.exports=o;function o(s){return s instanceof Date&&!Number.isNaN(s.getTime())}e(o,"isValidDate")}}),qe=P({"lib/utils/create-date.js"(a,t){"use strict";t.exports=s;var o=Se();function s(u){let i=new Date(u);return o(i)||(i=new Date(+u)),i}e(s,"createDate")}}),We=P({"lib/utils/format-time.js"(a,t){"use strict";t.exports=l;var{DATE_FORMAT:o,DATE_FORMAT_SIMPLE:s}=re(),u=$e(),i=qe(),c=Se();function l(O,h=!1){if(h===!1)return O;let j=i(O);if(!c(j))return O;if(h===!0)return u(j,s);let E=h.toUpperCase();if(E==="SYS:STANDARD")return u(j,o);let f=E.substr(0,4);return f==="SYS:"||f==="UTC:"?f==="UTC:"?u(j,h):u(j,h.slice(4)):u(j,`UTC:${h}`)}e(l,"formatTime")}}),He=P({"lib/utils/prettify-time.js"(a,t){"use strict";t.exports=s;var o=We();function s({log:u,context:i}){let{timestampKey:c,translateTime:l}=i,O=i.customPrettifiers?.time,h=null;if(c in u?h=u[c]:"timestamp"in u&&(h=u.timestamp),h===null)return;let j=l?o(h,l):h;return O?O(j):`[${j}]`}e(s,"prettifyTime")}}),Ve=P({"node_modules/fast-copy/dist/cjs/index.cjs"(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var t=Function.prototype.toString,o=Object.create,s=Object.prototype.toString,u=function(){function n(){this._keys=[],this._values=[]}return e(n,"LegacyCache2"),n.prototype.has=function(y){return!!~this._keys.indexOf(y)},n.prototype.get=function(y){return this._values[this._keys.indexOf(y)]},n.prototype.set=function(y,N){this._keys.push(y),this._values.push(N)},n}();function i(){return new u}e(i,"createCacheLegacy");function c(){return new WeakMap}e(c,"createCacheModern");var l=typeof WeakMap<"u"?c:i;function O(n){if(!n)return o(null);var y=n.constructor;if(y===Object)return n===Object.prototype?{}:o(n);if(~t.call(y).indexOf("[native code]"))try{return new y}catch{}return o(n)}e(O,"getCleanClone");function h(n){var y="";return n.global&&(y+="g"),n.ignoreCase&&(y+="i"),n.multiline&&(y+="m"),n.unicode&&(y+="u"),n.sticky&&(y+="y"),y}e(h,"getRegExpFlagsLegacy");function j(n){return n.flags}e(j,"getRegExpFlagsModern");var E=/test/g.flags==="g"?j:h;function f(n){var y=s.call(n);return y.substring(8,y.length-1)}e(f,"getTagLegacy");function L(n){return n[Symbol.toStringTag]||f(n)}e(L,"getTagModern");var r=typeof Symbol<"u"?L:f,p=Object.defineProperty,g=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,_=Object.prototype,w=_.hasOwnProperty,M=_.propertyIsEnumerable,d=typeof b=="function";function v(n){return m(n).concat(b(n))}e(v,"getStrictPropertiesModern");var C=d?v:m;function T(n,y,N){for(var A=C(n),$=0,R=A.length,B=void 0,D=void 0;$<R;++$)if(B=A[$],!(B==="callee"||B==="caller")){if(D=g(n,B),!D){y[B]=N.copier(n[B],N);continue}!D.get&&!D.set&&(D.value=N.copier(D.value,N));try{p(y,B,D)}catch{y[B]=D.value}}return y}e(T,"copyOwnPropertiesStrict");function x(n,y){var N=new y.Constructor;y.cache.set(n,N);for(var A=0,$=n.length;A<$;++A)N[A]=y.copier(n[A],y);return N}e(x,"copyArrayLoose");function I(n,y){var N=new y.Constructor;return y.cache.set(n,N),T(n,N,y)}e(I,"copyArrayStrict");function F(n,y){return n.slice(0)}e(F,"copyArrayBuffer");function K(n,y){return n.slice(0,n.size,n.type)}e(K,"copyBlob");function q(n,y){return new y.Constructor(F(n.buffer))}e(q,"copyDataView");function H(n,y){return new y.Constructor(n.getTime())}e(H,"copyDate");function S(n,y){var N=new y.Constructor;return y.cache.set(n,N),n.forEach(function(A,$){N.set($,y.copier(A,y))}),N}e(S,"copyMapLoose");function Z(n,y){return T(n,S(n,y),y)}e(Z,"copyMapStrict");function U(n,y){var N=O(y.prototype);y.cache.set(n,N);for(var A in n)w.call(n,A)&&(N[A]=y.copier(n[A],y));return N}e(U,"copyObjectLooseLegacy");function X(n,y){var N=O(y.prototype);y.cache.set(n,N);for(var A in n)w.call(n,A)&&(N[A]=y.copier(n[A],y));for(var $=b(n),R=0,B=$.length,D=void 0;R<B;++R)D=$[R],M.call(n,D)&&(N[D]=y.copier(n[D],y));return N}e(X,"copyObjectLooseModern");var te=d?X:U;function z(n,y){var N=O(y.prototype);return y.cache.set(n,N),T(n,N,y)}e(z,"copyObjectStrict");function Y(n,y){return new y.Constructor(n.valueOf())}e(Y,"copyPrimitiveWrapper");function ue(n,y){var N=new y.Constructor(n.source,E(n));return N.lastIndex=n.lastIndex,N}e(ue,"copyRegExp");function k(n,y){return n}e(k,"copySelf");function ne(n,y){var N=new y.Constructor;return y.cache.set(n,N),n.forEach(function(A){N.add(y.copier(A,y))}),N}e(ne,"copySetLoose");function ce(n,y){return T(n,ne(n,y),y)}e(ce,"copySetStrict");var le=Array.isArray,Q=Object.assign,fe=Object.getPrototypeOf||function(n){return n.__proto__},ie={array:x,arrayBuffer:F,blob:K,dataView:q,date:H,error:k,map:S,object:te,regExp:ue,set:ne},ye=Q({},ie,{array:I,map:Z,object:z,set:ce});function me(n){return{Arguments:n.object,Array:n.array,ArrayBuffer:n.arrayBuffer,Blob:n.blob,Boolean:Y,DataView:n.dataView,Date:n.date,Error:n.error,Float32Array:n.arrayBuffer,Float64Array:n.arrayBuffer,Int8Array:n.arrayBuffer,Int16Array:n.arrayBuffer,Int32Array:n.arrayBuffer,Map:n.map,Number:Y,Object:n.object,Promise:k,RegExp:n.regExp,Set:n.set,String:Y,WeakMap:k,WeakSet:k,Uint8Array:n.arrayBuffer,Uint8ClampedArray:n.arrayBuffer,Uint16Array:n.arrayBuffer,Uint32Array:n.arrayBuffer,Uint64Array:n.arrayBuffer}}e(me,"getTagSpecificCopiers");function ee(n){var y=Q({},ie,n),N=me(y),A=N.Array,$=N.Object;function R(B,D){if(D.prototype=D.Constructor=void 0,!B||typeof B!="object")return B;if(D.cache.has(B))return D.cache.get(B);if(D.prototype=fe(B),D.Constructor=D.prototype&&D.prototype.constructor,!D.Constructor||D.Constructor===Object)return $(B,D);if(le(B))return A(B,D);var W=N[r(B)];return W?W(B,D):typeof B.then=="function"?B:$(B,D)}return e(R,"copier"),e(function(D){return R(D,{Constructor:void 0,cache:l(),copier:R,prototype:void 0})},"copy")}e(ee,"createCopier");function oe(n){return ee(Q({},ye,n))}e(oe,"createStrictCopier");var de=oe({}),pe=ee({});a.copyStrict=de,a.createCopier=ee,a.createStrictCopier=oe,a.default=pe}}),Ge=P({"lib/utils/delete-log-property.js"(a,t){"use strict";t.exports=u;var o=se(),s=Le();function u(i,c){let l=s(c),O=l.pop();i=o(i,l),i!==null&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,O)&&delete i[O]}e(u,"deleteLogProperty")}}),Ue=P({"lib/utils/filter-log.js"(a,t){"use strict";t.exports=i;var{createCopier:o}=Ve(),s=o({}),u=Ge();function i({log:c,context:l}){let{ignoreKeys:O,includeKeys:h}=l,j=s(c);if(h){let E={};return h.forEach(f=>{E[f]=j[f]}),E}return O.forEach(E=>{u(j,E)}),j}e(i,"filterLog")}}),Ye=P({"lib/pretty.js"(a,t){t.exports=p;var o=Be(),s=Oe(),u=Re(),i=xe(),c=Fe(),l=Ke(),O=Ee(),h=He(),j=Ue(),{LEVELS:E,LEVEL_KEY:f,LEVEL_NAMES:L}=re(),r=e(g=>{try{return{value:o.parse(g,{protoAction:"remove"})}}catch(m){return{err:m}}},"jsonParser");function p(g){let m;if(s(g))m=g;else{let v=r(g);if(v.err||!s(v.value))return g+this.EOL;m=v.value}if(this.minimumLevel){let v;this.useOnlyCustomProps?v=this.customLevels:v=this.customLevelNames[this.minimumLevel]!==void 0;let C;if(v?C=this.customLevelNames[this.minimumLevel]:C=L[this.minimumLevel],C||(C=typeof this.minimumLevel=="string"?L[this.minimumLevel]:L[E[this.minimumLevel].toLowerCase()]),m[this.levelKey===void 0?f:this.levelKey]<C)return}let b=c({log:m,context:this.context});(this.ignoreKeys||this.includeKeys)&&(m=j({log:m,context:this.context}));let _=i({log:m,context:{...this.context,...this.context.customProperties}}),w=l({log:m,context:this.context}),M=h({log:m,context:this.context}),d="";if(this.levelFirst&&_&&(d=`${_}`),M&&d===""?d=`${M}`:M&&(d=`${d} ${M}`),!this.levelFirst&&_&&(d.length>0?d=`${d} ${_}`:d=_),w&&(d.length>0?d=`${d} ${w}:`:d=w),d.endsWith(":")===!1&&d!==""&&(d+=":"),b!==void 0&&(d.length>0?d=`${d} ${b}`:d=b),d.length>0&&!this.singleLine&&(d+=this.EOL),m.type==="Error"&&m.stack){let v=u({log:m,context:this.context});this.singleLine&&(d+=this.EOL),d+=v}else if(this.hideObject===!1){let v=[this.messageKey,this.levelKey,this.timestampKey].filter(T=>typeof m[T]=="string"||typeof m[T]=="number"||typeof m[T]=="boolean"),C=O({log:m,skipKeys:v,context:this.context});this.singleLine&&!/^\s$/.test(C)&&(d+=" "),d+=C}return d}e(p,"pretty")}}),Me=Ye();var ze=Object.getOwnPropertyNames;var J=e((a,t)=>e(function(){return t||(0,a[ze(a)[0]])((t={exports:{}}).exports,t),t.exports},"__require2"),"__commonJS"),je=J({"lib/constants.js"(a,t){"use strict";t.exports={DATE_FORMAT:"yyyy-mm-dd HH:MM:ss.l o",DATE_FORMAT_SIMPLE:"HH:MM:ss.l",ERROR_LIKE_KEYS:["err","error"],MESSAGE_KEY:"msg",LEVEL_KEY:"level",LEVEL_LABEL:"levelLabel",TIMESTAMP_KEY:"time",LEVELS:{default:"USERLVL",60:"FATAL",50:"ERROR",40:"WARN",30:"INFO",20:"DEBUG",10:"TRACE"},LEVEL_NAMES:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},LOGGER_KEYS:["pid","hostname","name","level","time","timestamp","caller"]}}}),ke=J({"node_modules/colorette/index.cjs"(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var{env:t={},argv:o=[],platform:s=""}=typeof process>"u"?{}:process,u="NO_COLOR"in t||o.includes("--no-color"),i="FORCE_COLOR"in t||o.includes("--color"),c=s==="win32",l=t.TERM==="dumb",O=globalThis.Deno&&globalThis.Deno.isatty(1)&&t.TERM&&!l,h="CI"in t&&("GITHUB_ACTIONS"in t||"GITLAB_CI"in t||"CIRCLECI"in t),j=!u&&(i||c&&!l||O||h),E=e((R,B,D,W,V=B.substring(0,R)+W,ge=B.substring(R+D.length),_e=ge.indexOf(D))=>V+(_e<0?ge:E(_e,ge,D,W)),"replaceClose"),f=e((R,B,D,W,V)=>R<0?D+B+W:D+E(R,B,W,V)+W,"clearBleed"),L=e((R,B,D=R,W=R.length+1)=>V=>V||!(V===""||V===void 0)?f((""+V).indexOf(B,W),V,R,B,D):"","filterEmpty"),r=e((R,B,D)=>L(`\x1B[${R}m`,`\x1B[${B}m`,D),"init"),p={reset:r(0,0),bold:r(1,22,"\x1B[22m\x1B[1m"),dim:r(2,22,"\x1B[22m\x1B[2m"),italic:r(3,23),underline:r(4,24),inverse:r(7,27),hidden:r(8,28),strikethrough:r(9,29),black:r(30,39),red:r(31,39),green:r(32,39),yellow:r(33,39),blue:r(34,39),magenta:r(35,39),cyan:r(36,39),white:r(37,39),gray:r(90,39),bgBlack:r(40,49),bgRed:r(41,49),bgGreen:r(42,49),bgYellow:r(43,49),bgBlue:r(44,49),bgMagenta:r(45,49),bgCyan:r(46,49),bgWhite:r(47,49),blackBright:r(90,39),redBright:r(91,39),greenBright:r(92,39),yellowBright:r(93,39),blueBright:r(94,39),magentaBright:r(95,39),cyanBright:r(96,39),whiteBright:r(97,39),bgBlackBright:r(100,49),bgRedBright:r(101,49),bgGreenBright:r(102,49),bgYellowBright:r(103,49),bgBlueBright:r(104,49),bgMagentaBright:r(105,49),bgCyanBright:r(106,49),bgWhiteBright:r(107,49)},g=e(({useColor:R=j}={})=>R?p:Object.keys(p).reduce((B,D)=>({...B,[D]:String}),{}),"createColors"),{reset:m,bold:b,dim:_,italic:w,underline:M,inverse:d,hidden:v,strikethrough:C,black:T,red:x,green:I,yellow:F,blue:K,magenta:q,cyan:H,white:S,gray:Z,bgBlack:U,bgRed:X,bgGreen:te,bgYellow:z,bgBlue:Y,bgMagenta:ue,bgCyan:k,bgWhite:ne,blackBright:ce,redBright:le,greenBright:Q,yellowBright:fe,blueBright:ie,magentaBright:ye,cyanBright:me,whiteBright:ee,bgBlackBright:oe,bgRedBright:de,bgGreenBright:pe,bgYellowBright:n,bgBlueBright:y,bgMagentaBright:N,bgCyanBright:A,bgWhiteBright:$}=g();a.bgBlack=U,a.bgBlackBright=oe,a.bgBlue=Y,a.bgBlueBright=y,a.bgCyan=k,a.bgCyanBright=A,a.bgGreen=te,a.bgGreenBright=pe,a.bgMagenta=ue,a.bgMagentaBright=N,a.bgRed=X,a.bgRedBright=de,a.bgWhite=ne,a.bgWhiteBright=$,a.bgYellow=z,a.bgYellowBright=n,a.black=T,a.blackBright=ce,a.blue=K,a.blueBright=ie,a.bold=b,a.createColors=g,a.cyan=H,a.cyanBright=me,a.dim=_,a.gray=Z,a.green=I,a.greenBright=Q,a.hidden=v,a.inverse=d,a.isColorSupported=j,a.italic=w,a.magenta=q,a.magentaBright=ye,a.red=x,a.redBright=le,a.reset=m,a.strikethrough=C,a.underline=M,a.white=S,a.whiteBright=ee,a.yellow=F,a.yellowBright=fe}}),Je=J({"lib/colors.js"(a,t){"use strict";var{LEVELS:o,LEVEL_NAMES:s}=je(),u=e(d=>d,"nocolor"),i={default:u,60:u,50:u,40:u,30:u,20:u,10:u,message:u,greyMessage:u},{createColors:c}=ke(),l=c({useColor:!0}),{white:O,bgRed:h,red:j,yellow:E,green:f,blue:L,gray:r,cyan:p}=l,g={default:O,60:h,50:j,40:E,30:f,20:L,10:r,message:p,greyMessage:r};function m(d){return d.reduce(function(v,[C,T]){return v[C]=typeof l[T]=="function"?l[T]:O,v},{default:O,message:p,greyMessage:r})}e(m,"resolveCustomColoredColorizer");function b(d){return function(v,C,{customLevels:T,customLevelNames:x}={}){let I=d?T||o:Object.assign({},o,T),F=d?x||s:Object.assign({},s,x),K="default";Number.isInteger(+v)?K=Object.prototype.hasOwnProperty.call(I,v)?v:K:K=Object.prototype.hasOwnProperty.call(F,v.toLowerCase())?F[v.toLowerCase()]:K;let q=I[K];return Object.prototype.hasOwnProperty.call(C,K)?C[K](q):C.default(q)}}e(b,"colorizeLevel");function _(d){let v=b(d),C=e(function(T,x){return v(T,i,x)},"customColoredColorizer");return C.message=i.message,C.greyMessage=i.greyMessage,C}e(_,"plainColorizer");function w(d){let v=b(d),C=e(function(T,x){return v(T,g,x)},"customColoredColorizer");return C.message=g.message,C.greyMessage=g.greyMessage,C}e(w,"coloredColorizer");function M(d,v){let C=m(d),T=v?C:Object.assign({},g,C),x=b(v),I=e(function(F,K){return x(F,T,K)},"customColoredColorizer");return I.message=I.message||T.message,I.greyMessage=I.greyMessage||T.greyMessage,I}e(M,"customColoredColorizerFactory"),t.exports=e(function(v=!1,C,T){return v&&C!==void 0?M(C,T):v?w(T):_(T)},"getColorizer")}}),Ze=J({"lib/utils/handle-custom-levels-opts.js"(a,t){"use strict";t.exports=o;function o(s){return s?typeof s=="string"?s.split(",").reduce((u,i,c)=>{let[l,O=c]=i.split(":");return u[O]=l.toUpperCase(),u},{default:"USERLVL"}):Object.prototype.toString.call(s)==="[object Object]"?Object.keys(s).reduce((u,i)=>(u[s[i]]=i.toUpperCase(),u),{default:"USERLVL"}):{}:{}}e(o,"handleCustomLevelsOpts")}}),Xe=J({"lib/utils/handle-custom-levels-names-opts.js"(a,t){"use strict";t.exports=o;function o(s){return s?typeof s=="string"?s.split(",").reduce((u,i,c)=>{let[l,O=c]=i.split(":");return u[l.toLowerCase()]=O,u},{}):Object.prototype.toString.call(s)==="[object Object]"?Object.keys(s).reduce((u,i)=>(u[i.toLowerCase()]=s[i],u),{}):{}:{}}e(o,"handleCustomLevelsNamesOpts")}}),Qe=J({"lib/utils/parse-factory-options.js"(a,t){t.exports=c;var{LEVEL_NAMES:o}=je(),s=Je(),u=Ze(),i=Xe();function c(l){let O=l.crlf?`\r
`:`
`,h="    ",{customPrettifiers:j,errorLikeObjectKeys:E,hideObject:f,levelFirst:L,levelKey:r,levelLabel:p,messageFormat:g,messageKey:m,minimumLevel:b,singleLine:_,timestampKey:w,translateTime:M}=l,d=l.errorProps.split(","),v=typeof l.useOnlyCustomProps=="boolean"?l.useOnlyCustomProps:l.useOnlyCustomProps==="true",C=u(l.customLevels),T=i(l.customLevels),x;l.customColors&&(x=l.customColors.split(",").reduce((S,Z)=>{let[U,X]=Z.split(":"),z=(v?l.customLevels:T[U]!==void 0)?T[U]:o[U],Y=z!==void 0?z:U;return S.push([Y,X]),S},[]));let I={customLevels:C,customLevelNames:T};v===!0&&!l.customLevels&&(I.customLevels=void 0,I.customLevelNames=void 0);let F=l.include!==void 0?new Set(l.include.split(",")):void 0,K=!F&&l.ignore?new Set(l.ignore.split(",")):void 0,q=s(l.colorize,x,v),H=l.colorizeObjects?q:s(!1,[],!1);return{EOL:O,IDENT:h,colorizer:q,customColors:x,customLevelNames:T,customLevels:C,customPrettifiers:j,customProperties:I,errorLikeObjectKeys:E,errorProps:d,hideObject:f,ignoreKeys:K,includeKeys:F,levelFirst:L,levelKey:r,levelLabel:p,messageFormat:g,messageKey:m,minimumLevel:b,objectColorizer:H,singleLine:_,timestampKey:w,translateTime:M,useOnlyCustomProps:v}}e(c,"parseFactoryOptions")}}),Ce=Qe();var er={colorize:!0,colorizeObjects:!0,crlf:!1,customColors:null,customLevels:null,customPrettifiers:{},errorLikeObjectKeys:["err","error"],errorProps:"",hideObject:!1,ignore:"hostname",include:void 0,levelFirst:!1,levelKey:"level",levelLabel:"levelLabel",messageFormat:null,messageKey:"msg",minimumLevel:void 0,outputStream:console,singleLine:!1,timestampKey:"timestamp",translateTime:"SYS:HH:MM:ss",useOnlyCustomProps:!0};function rr(a){let t=Ce(Object.assign({},er,a));return Me.bind({...t,context:t})}e(rr,"prettyFactory");var we=rr({customPrettifiers:{time:a=>`${a}`}}),ae=class extends G.handlers.BaseHandler{static{e(this,"ConsoleHandler")}format(t){try{let o=JSON.parse(t.msg),s=t.levelName;return t.levelName==="WARNING"&&(s="WARN"),o.level=s,o.timestamp||(o.timestamp=t.datetime),typeof o.timestamp=="object"&&o.timestamp!==null&&(o.timestamp=t.datetime),delete o.hostname,we(o)}catch{let s=t.levelName;return t.levelName==="WARNING"&&(s="WARN"),we({level:s,timestamp:t.datetime,msg:t.msg})}}log(t){console.log(t)}};await G.setup({handlers:{console:new ae("DEBUG")},loggers:{default:{level:"DEBUG",handlers:["console"]}}});var ve=class{static{e(this,"DefaultConsoleAdapter")}debug(...t){t.forEach(o=>{console.debug(JSON.stringify(o))})}info(...t){t.forEach(o=>{console.info(JSON.stringify(o))})}log(...t){t.forEach(o=>{console.log(JSON.stringify(o))})}warn(...t){t.forEach(o=>{console.warn(JSON.stringify(o))})}error(...t){t.forEach(o=>{console.error(JSON.stringify(o))})}},be=class{static{e(this,"LocalConsoleAdapter")}debug(...t){t.forEach(o=>{G.debug(o)})}info(...t){t.forEach(o=>{G.info(o)})}log(...t){t.forEach(o=>{G.info(o)})}warn(...t){t.forEach(o=>{G.warning(o)})}error(...t){t.forEach(o=>{G.error(o)})}},ut=new ve,Te=new be;var tr="system-logger";globalThis.__ZUPLO_SERVICE_PROVIDER&&globalThis.__ZUPLO_SERVICE_PROVIDER.addService(tr,{logger:Te,captureUserLogs:!0});export{tr as SYSTEM_LOGGER};
