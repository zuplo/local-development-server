var Te=Object.defineProperty;var e=(M,i)=>Te(M,"name",{value:i,configurable:!0});import{bundle as Ge,transpile as ze}from"https://deno.land/x/emit@0.24.1/mod.ts";import{format as ie}from"https://deno.land/std@0.195.0/datetime/mod.ts";import{load as Xe}from"https://deno.land/std@0.195.0/dotenv/mod.ts";import{createOAuth2Token as er}from"https://deno.land/x/deno_gcp_admin@0.0.5/auth.ts";import{parse as tr}from"https://deno.land/std@0.195.0/flags/mod.ts";import{Server as ir}from"https://deno.land/std@0.195.0/http/server.ts";import*as or from"https://deno.land/std@0.195.0/fs/mod.ts";import*as sr from"https://deno.land/std@0.195.0/http/http_status.ts";import*as I from"https://deno.land/std@0.195.0/log/mod.ts";import*as ar from"https://deno.land/std@0.195.0/path/mod.ts";import{assert as cr,assertAlmostEquals as fr,assertArrayIncludes as lr,assertEquals as yr,assertExists as pr,assertFalse as mr,assertInstanceOf as dr,assertIsError as gr,assertMatch as hr,assertNotEquals as vr,assertNotMatch as _r,assertNotStrictEquals as Or,assertObjectMatch as br,assertRejects as Lr,assertStrictEquals as Er,assertStringIncludes as Sr,assertThrows as Tr,equal as Mr,fail as jr,unimplemented as Dr,unreachable as wr}from"https://deno.land/std@0.195.0/testing/asserts.ts";import{afterAll as Pr,afterEach as Nr,beforeAll as Ar,beforeEach as Cr,describe as $r,it as Fr}from"https://deno.land/std@0.195.0/testing/bdd.ts";var Me=Object.getOwnPropertyNames,N=e((M,i)=>e(function(){return i||(0,M[Me(M)[0]])((i={exports:{}}).exports,i),i.exports},"__require"),"__commonJS"),je=N({"node_modules/secure-json-parse/index.js"(M,i){"use strict";var s=typeof Buffer<"u",f=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,y=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function n(p,E,_){_==null&&E!==null&&typeof E=="object"&&(_=E,E=void 0),s&&Buffer.isBuffer(p)&&(p=p.toString()),p&&p.charCodeAt(0)===65279&&(p=p.slice(1));let a=JSON.parse(p,E);if(a===null||typeof a!="object")return a;let h=_&&_.protoAction||"error",t=_&&_.constructorAction||"error";if(h==="ignore"&&t==="ignore")return a;if(h!=="ignore"&&t!=="ignore"){if(f.test(p)===!1&&y.test(p)===!1)return a}else if(h!=="ignore"&&t==="ignore"){if(f.test(p)===!1)return a}else if(y.test(p)===!1)return a;return o(a,{protoAction:h,constructorAction:t,safe:_&&_.safe})}e(n,"_parse");function o(p,{protoAction:E="error",constructorAction:_="error",safe:a}={}){let h=[p];for(;h.length;){let t=h;h=[];for(let l of t){if(E!=="ignore"&&Object.prototype.hasOwnProperty.call(l,"__proto__")){if(a===!0)return null;if(E==="error")throw new SyntaxError("Object contains forbidden prototype property");delete l.__proto__}if(_!=="ignore"&&Object.prototype.hasOwnProperty.call(l,"constructor")&&Object.prototype.hasOwnProperty.call(l.constructor,"prototype")){if(a===!0)return null;if(_==="error")throw new SyntaxError("Object contains forbidden prototype property");delete l.constructor}for(let m in l){let c=l[m];c&&typeof c=="object"&&h.push(c)}}}return p}e(o,"filter");function v(p,E,_){let a=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(p,E,_)}finally{Error.stackTraceLimit=a}}e(v,"parse");function S(p,E){let _=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(p,E,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=_}}e(S,"safeParse"),i.exports=v,i.exports.default=v,i.exports.parse=v,i.exports.safeParse=S,i.exports.scan=o}}),oe=N({"lib/utils/is-object.js"(M,i){"use strict";i.exports=s;function s(f){return Object.prototype.toString.apply(f)==="[object Object]"}e(s,"isObject")}}),W=N({"lib/constants.js"(M,i){"use strict";i.exports={DATE_FORMAT:"yyyy-mm-dd HH:MM:ss.l o",DATE_FORMAT_SIMPLE:"HH:MM:ss.l",ERROR_LIKE_KEYS:["err","error"],MESSAGE_KEY:"msg",LEVEL_KEY:"level",LEVEL_LABEL:"levelLabel",TIMESTAMP_KEY:"time",LEVELS:{default:"USERLVL",60:"FATAL",50:"ERROR",40:"WARN",30:"INFO",20:"DEBUG",10:"TRACE"},LEVEL_NAMES:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},LOGGER_KEYS:["pid","hostname","name","level","time","timestamp","caller"]}}}),X=N({"lib/utils/join-lines-with-indentation.js"(M,i){"use strict";i.exports=s;function s({input:f,ident:y="    ",eol:n=`
`}){let o=f.split(/\r?\n/);for(let v=1;v<o.length;v+=1)o[v]=y+o[v];return o.join(n)}e(s,"joinLinesWithIndentation")}}),De=N({"node_modules/fast-safe-stringify/index.js"(M,i){i.exports=v,v.default=v,v.stable=_,v.stableStringify=_;var s="[...]",f="[Circular]",y=[],n=[];function o(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}e(o,"defaultOptions");function v(t,l,m,c){typeof c>"u"&&(c=o()),p(t,"",0,[],void 0,0,c);var O;try{n.length===0?O=JSON.stringify(t,l,m):O=JSON.stringify(t,h(l),m)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;y.length!==0;){var d=y.pop();d.length===4?Object.defineProperty(d[0],d[1],d[3]):d[0][d[1]]=d[2]}}return O}e(v,"stringify");function S(t,l,m,c){var O=Object.getOwnPropertyDescriptor(c,m);O.get!==void 0?O.configurable?(Object.defineProperty(c,m,{value:t}),y.push([c,m,l,O])):n.push([l,m,t]):(c[m]=t,y.push([c,m,l]))}e(S,"setReplace");function p(t,l,m,c,O,d,T){d+=1;var b;if(typeof t=="object"&&t!==null){for(b=0;b<c.length;b++)if(c[b]===t){S(f,t,l,O);return}if(typeof T.depthLimit<"u"&&d>T.depthLimit){S(s,t,l,O);return}if(typeof T.edgesLimit<"u"&&m+1>T.edgesLimit){S(s,t,l,O);return}if(c.push(t),Array.isArray(t))for(b=0;b<t.length;b++)p(t[b],b,b,c,t,d,T);else{var L=Object.keys(t);for(b=0;b<L.length;b++){var j=L[b];p(t[j],j,b,c,t,d,T)}}c.pop()}}e(p,"decirc");function E(t,l){return t<l?-1:t>l?1:0}e(E,"compareFunction");function _(t,l,m,c){typeof c>"u"&&(c=o());var O=a(t,"",0,[],void 0,0,c)||t,d;try{n.length===0?d=JSON.stringify(O,l,m):d=JSON.stringify(O,h(l),m)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;y.length!==0;){var T=y.pop();T.length===4?Object.defineProperty(T[0],T[1],T[3]):T[0][T[1]]=T[2]}}return d}e(_,"deterministicStringify");function a(t,l,m,c,O,d,T){d+=1;var b;if(typeof t=="object"&&t!==null){for(b=0;b<c.length;b++)if(c[b]===t){S(f,t,l,O);return}try{if(typeof t.toJSON=="function")return}catch{return}if(typeof T.depthLimit<"u"&&d>T.depthLimit){S(s,t,l,O);return}if(typeof T.edgesLimit<"u"&&m+1>T.edgesLimit){S(s,t,l,O);return}if(c.push(t),Array.isArray(t))for(b=0;b<t.length;b++)a(t[b],b,b,c,t,d,T);else{var L={},j=Object.keys(t).sort(E);for(b=0;b<j.length;b++){var w=j[b];a(t[w],w,b,c,t,d,T),L[w]=t[w]}if(typeof O<"u")y.push([O,l,t]),O[l]=L;else return L}c.pop()}}e(a,"deterministicDecirc");function h(t){return t=typeof t<"u"?t:function(l,m){return m},function(l,m){if(n.length>0)for(var c=0;c<n.length;c++){var O=n[c];if(O[1]===l&&O[0]===m){m=O[2],n.splice(c,1);break}}return t.call(this,l,m)}}e(h,"replaceGetterValues")}}),we=N({"lib/utils/prettify-error.js"(M,i){"use strict";i.exports=f;var s=X();function f({keyName:y,lines:n,eol:o,ident:v}){let S="",p=s({input:n,ident:v,eol:o}),E=`${v}${y}: ${p}${o}`.split(o);for(let _=0;_<E.length;_+=1){_!==0&&(S+=o);let a=E[_];if(/^\s*"stack"/.test(a)){let h=/^(\s*"stack":)\s*(".*"),?$/.exec(a);if(h&&h.length===3){let t=/^\s*/.exec(a)[0].length+4,l=" ".repeat(t),m=h[2];S+=h[1]+o+l+JSON.parse(m).replace(/\n/g,o+l)}else S+=a}else S+=a}return S}e(f,"prettifyError")}}),se=N({"lib/utils/prettify-object.js"(M,i){"use strict";i.exports=o;var{LOGGER_KEYS:s}=W(),f=De(),y=X(),n=we();function o({log:v,excludeLoggerKeys:S=!0,skipKeys:p=[],context:E}){let{EOL:_,IDENT:a,customPrettifiers:h,errorLikeObjectKeys:t,objectColorizer:l,singleLine:m}=E,c=[].concat(p);S===!0&&Array.prototype.push.apply(c,s);let O="",{plain:d,errors:T}=Object.entries(v).reduce(({plain:b,errors:L},[j,w])=>{if(c.includes(j)===!1){let C=typeof h[j]=="function"?h[j](w,j,v):w;t.includes(j)?L[j]=C:b[j]=C}return{plain:b,errors:L}},{plain:{},errors:{}});return m?(Object.keys(d).length>0&&(O+=l.greyMessage(f(d))),O+=_,O=O.replace(/\\\\/gi,"\\")):Object.entries(d).forEach(([b,L])=>{let j=typeof h[b]=="function"?L:f(L,null,2);if(j===void 0)return;j=j.replace(/\\\\/gi,"\\");let w=y({input:j,ident:a,eol:_});O+=`${a}${b}:${w.startsWith(_)?"":" "}${w}${_}`}),Object.entries(T).forEach(([b,L])=>{let j=typeof h[b]=="function"?L:f(L,null,2);j!==void 0&&(O+=n({keyName:b,lines:j,eol:_,ident:a}))}),O}e(o,"prettifyObject")}}),xe=N({"lib/utils/prettify-error-log.js"(M,i){"use strict";i.exports=o;var{LOGGER_KEYS:s}=W(),f=oe(),y=X(),n=se();function o({log:v,context:S}){let{EOL:p,IDENT:E,errorProps:_,messageKey:a}=S,h=v.stack,t=y({input:h,ident:E,eol:p}),l=`${E}${t}${p}`;if(_.length>0){let m=s.concat(a,"type","stack"),c;_[0]==="*"?c=Object.keys(v).filter(O=>m.includes(O)===!1):c=_.filter(O=>m.includes(O)===!1);for(let O=0;O<c.length;O+=1){let d=c[O];if(d in v){if(f(v[d])){let T=n({log:v[d],excludeLoggerKeys:!1,context:{...S,IDENT:E+E}});l=`${l}${E}${d}: {${p}${T}${E}}${p}`;continue}l=`${l}${E}${d}: ${v[d]}${p}`}}}return l}e(o,"prettifyErrorLog")}}),ae=N({"lib/utils/split-property-key.js"(M,i){"use strict";i.exports=s;function s(f){let y=[],n=!1,o="";for(let v=0;v<f.length;v++){let S=f.charAt(v);if(S==="\\"){n=!0;continue}if(n){n=!1,o+=S;continue}if(S==="."){y.push(o),o="";continue}o+=S}return o.length&&y.push(o),y}e(s,"splitPropertyKey")}}),J=N({"lib/utils/get-property-value.js"(M,i){"use strict";i.exports=f;var s=ae();function f(y,n){let o=Array.isArray(n)?n:s(n);for(let v of o){if(!Object.prototype.hasOwnProperty.call(y,v))return;y=y[v]}return y}e(f,"getPropertyValue")}}),Pe=N({"lib/utils/prettify-level.js"(M,i){"use strict";i.exports=f;var s=J();function f({log:y,context:n}){let{colorizer:o,customLevels:v,customLevelNames:S,levelKey:p}=n,E=n.customPrettifiers?.level,_=s(y,p);if(_!==void 0)return E?E(_):o(_,{customLevels:v,customLevelNames:S})}e(f,"prettifyLevel")}}),Ne=N({"lib/utils/interpret-conditionals.js"(M,i){"use strict";i.exports=f;var s=J();function f(y,n){return y=y.replace(/{if (.*?)}(.*?){end}/g,o),y=y.replace(/{if (.*?)}/g,""),y=y.replace(/{end}/g,""),y.replace(/\s+/g," ").trim();function o(v,S,p){let E=s(n,S);return E&&p.includes(S)?p.replace(new RegExp("{"+S+"}","g"),E):""}e(o,"replacer")}e(f,"interpretConditionals")}}),Ae=N({"lib/utils/prettify-message.js"(M,i){"use strict";i.exports=n;var{LEVELS:s}=W(),f=J(),y=Ne();function n({log:o,context:v}){let{colorizer:S,customLevels:p,levelKey:E,levelLabel:_,messageFormat:a,messageKey:h,useOnlyCustomProps:t}=v;if(a&&typeof a=="string"){let l=y(a,o),m=String(l).replace(/{([^{}]+)}/g,function(c,O){let d;return O===_&&(d=f(o,E))!==void 0?(t?p===void 0:p[d]===void 0)?s[d]:p[d]:f(o,O)||""});return S.message(m)}if(a&&typeof a=="function"){let l=a(o,h,_);return S.message(l)}if(h in o&&!(typeof o[h]!="string"&&typeof o[h]!="number"&&typeof o[h]!="boolean"))return S.message(o[h])}e(n,"prettifyMessage")}}),Ce=N({"lib/utils/prettify-metadata.js"(M,i){"use strict";i.exports=s;function s({log:f,context:y}){let n=y.customPrettifiers,o="";if(f.name||f.pid||f.hostname){if(o+="(",f.name&&(o+=n.name?n.name(f.name):f.name),f.pid){let v=n.pid?n.pid(f.pid):f.pid;f.name&&f.pid?o+="/"+v:o+=v}f.hostname&&(o+=`${o==="("?"on":" on"} ${n.hostname?n.hostname(f.hostname):f.hostname}`),o+=")"}if(f.caller&&(o+=`${o===""?"":" "}<${n.caller?n.caller(f.caller):f.caller}>`),o!=="")return o}e(s,"prettifyMetadata")}}),$e=N({"node_modules/dateformat/lib/dateformat.js"(M,i){"use strict";function s(f){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?s=e(function(n){return typeof n},"_typeof2"):s=e(function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},"_typeof2"),s(f)}e(s,"_typeof"),function(f){var y=arguments,n=function(){var _=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,a=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,h=/[^-+\dA-Z]/g;return function(t,l,m,c){if(y.length===1&&E(t)==="string"&&!/\d/.test(t)&&(l=t,t=void 0),t=t||t===0?t:new Date,t instanceof Date||(t=new Date(t)),isNaN(t))throw TypeError("Invalid date");l=String(n.masks[l]||l||n.masks.default);var O=l.slice(0,4);(O==="UTC:"||O==="GMT:")&&(l=l.slice(4),m=!0,O==="GMT:"&&(c=!0));var d=e(function(){return m?"getUTC":"get"},"_2"),T=e(function(){return t[d()+"Date"]()},"d"),b=e(function(){return t[d()+"Day"]()},"D2"),L=e(function(){return t[d()+"Month"]()},"m"),j=e(function(){return t[d()+"FullYear"]()},"y2"),w=e(function(){return t[d()+"Hours"]()},"H"),C=e(function(){return t[d()+"Minutes"]()},"M"),K=e(function(){return t[d()+"Seconds"]()},"s"),H=e(function(){return t[d()+"Milliseconds"]()},"L"),F=e(function(){return m?0:t.getTimezoneOffset()},"o"),q=e(function(){return S(t)},"W"),U=e(function(){return p(t)},"N"),B={d:e(function(){return T()},"d"),dd:e(function(){return o(T())},"dd"),ddd:e(function(){return n.i18n.dayNames[b()]},"ddd"),DDD:e(function(){return v({y:j(),m:L(),d:T(),_:d(),dayName:n.i18n.dayNames[b()],short:!0})},"DDD"),dddd:e(function(){return n.i18n.dayNames[b()+7]},"dddd"),DDDD:e(function(){return v({y:j(),m:L(),d:T(),_:d(),dayName:n.i18n.dayNames[b()+7]})},"DDDD"),m:e(function(){return L()+1},"m"),mm:e(function(){return o(L()+1)},"mm"),mmm:e(function(){return n.i18n.monthNames[L()]},"mmm"),mmmm:e(function(){return n.i18n.monthNames[L()+12]},"mmmm"),yy:e(function(){return String(j()).slice(2)},"yy"),yyyy:e(function(){return o(j(),4)},"yyyy"),h:e(function(){return w()%12||12},"h"),hh:e(function(){return o(w()%12||12)},"hh"),H:e(function(){return w()},"H"),HH:e(function(){return o(w())},"HH"),M:e(function(){return C()},"M"),MM:e(function(){return o(C())},"MM"),s:e(function(){return K()},"s"),ss:e(function(){return o(K())},"ss"),l:e(function(){return o(H(),3)},"l"),L:e(function(){return o(Math.floor(H()/10))},"L"),t:e(function(){return w()<12?n.i18n.timeNames[0]:n.i18n.timeNames[1]},"t"),tt:e(function(){return w()<12?n.i18n.timeNames[2]:n.i18n.timeNames[3]},"tt"),T:e(function(){return w()<12?n.i18n.timeNames[4]:n.i18n.timeNames[5]},"T"),TT:e(function(){return w()<12?n.i18n.timeNames[6]:n.i18n.timeNames[7]},"TT"),Z:e(function(){return c?"GMT":m?"UTC":(String(t).match(a)||[""]).pop().replace(h,"").replace(/GMT\+0000/g,"UTC")},"Z"),o:e(function(){return(F()>0?"-":"+")+o(Math.floor(Math.abs(F())/60)*100+Math.abs(F())%60,4)},"o"),p:e(function(){return(F()>0?"-":"+")+o(Math.floor(Math.abs(F())/60),2)+":"+o(Math.floor(Math.abs(F())%60),2)},"p"),S:e(function(){return["th","st","nd","rd"][T()%10>3?0:(T()%100-T()%10!=10)*T()%10]},"S"),W:e(function(){return q()},"W"),WW:e(function(){return o(q())},"WW"),N:e(function(){return U()},"N")};return l.replace(_,function(g){return g in B?B[g]():g.slice(1,g.length-1)})}}();n.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},n.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]};var o=e(function(a,h){for(a=String(a),h=h||2;a.length<h;)a="0"+a;return a},"pad2"),v=e(function(a){var h=a.y,t=a.m,l=a.d,m=a._,c=a.dayName,O=a.short,d=O===void 0?!1:O,T=new Date,b=new Date;b.setDate(b[m+"Date"]()-1);var L=new Date;L.setDate(L[m+"Date"]()+1);var j=e(function(){return T[m+"Date"]()},"today_d2"),w=e(function(){return T[m+"Month"]()},"today_m2"),C=e(function(){return T[m+"FullYear"]()},"today_y2"),K=e(function(){return b[m+"Date"]()},"yesterday_d2"),H=e(function(){return b[m+"Month"]()},"yesterday_m2"),F=e(function(){return b[m+"FullYear"]()},"yesterday_y2"),q=e(function(){return L[m+"Date"]()},"tomorrow_d2"),U=e(function(){return L[m+"Month"]()},"tomorrow_m2"),B=e(function(){return L[m+"FullYear"]()},"tomorrow_y2");return C()===h&&w()===t&&j()===l?d?"Tdy":"Today":F()===h&&H()===t&&K()===l?d?"Ysd":"Yesterday":B()===h&&U()===t&&q()===l?d?"Tmw":"Tomorrow":c},"getDayName2"),S=e(function(a){var h=new Date(a.getFullYear(),a.getMonth(),a.getDate());h.setDate(h.getDate()-(h.getDay()+6)%7+3);var t=new Date(h.getFullYear(),0,4);t.setDate(t.getDate()-(t.getDay()+6)%7+3);var l=h.getTimezoneOffset()-t.getTimezoneOffset();h.setHours(h.getHours()-l);var m=(h-t)/(864e5*7);return 1+Math.floor(m)},"getWeek2"),p=e(function(a){var h=a.getDay();return h===0&&(h=7),h},"getDayOfWeek2"),E=e(function(a){return a===null?"null":a===void 0?"undefined":s(a)!=="object"?s(a):Array.isArray(a)?"array":{}.toString.call(a).slice(8,-1).toLowerCase()},"kindOf2");typeof define=="function"&&define.amd?define(function(){return n}):(typeof M>"u"?"undefined":s(M))==="object"?i.exports=n:f.dateFormat=n}(void 0)}}),ue=N({"lib/utils/is-valid-date.js"(M,i){"use strict";i.exports=s;function s(f){return f instanceof Date&&!Number.isNaN(f.getTime())}e(s,"isValidDate")}}),Fe=N({"lib/utils/create-date.js"(M,i){"use strict";i.exports=f;var s=ue();function f(y){let n=new Date(y);return s(n)||(n=new Date(+y)),n}e(f,"createDate")}}),Ie=N({"lib/utils/format-time.js"(M,i){"use strict";i.exports=v;var{DATE_FORMAT:s,DATE_FORMAT_SIMPLE:f}=W(),y=$e(),n=Fe(),o=ue();function v(S,p=!1){if(p===!1)return S;let E=n(S);if(!o(E))return S;if(p===!0)return y(E,f);let _=p.toUpperCase();if(_==="SYS:STANDARD")return y(E,s);let a=_.substr(0,4);return a==="SYS:"||a==="UTC:"?a==="UTC:"?y(E,p):y(E,p.slice(4)):y(E,`UTC:${p}`)}e(v,"formatTime")}}),Re=N({"lib/utils/prettify-time.js"(M,i){"use strict";i.exports=f;var s=Ie();function f({log:y,context:n}){let{timestampKey:o,translateTime:v}=n,S=n.customPrettifiers?.time,p=null;if(o in y?p=y[o]:"timestamp"in y&&(p=y.timestamp),p===null)return;let E=v?s(p,v):p;return S?S(E):`[${E}]`}e(f,"prettifyTime")}}),Ke=N({"node_modules/fast-copy/dist/cjs/index.cjs"(M){"use strict";Object.defineProperty(M,"__esModule",{value:!0});var i=Function.prototype.toString,s=Object.create,f=Object.prototype.toString,y=function(){function r(){this._keys=[],this._values=[]}return e(r,"LegacyCache2"),r.prototype.has=function(u){return!!~this._keys.indexOf(u)},r.prototype.get=function(u){return this._values[this._keys.indexOf(u)]},r.prototype.set=function(u,D){this._keys.push(u),this._values.push(D)},r}();function n(){return new y}e(n,"createCacheLegacy");function o(){return new WeakMap}e(o,"createCacheModern");var v=typeof WeakMap<"u"?o:n;function S(r){if(!r)return s(null);var u=r.constructor;if(u===Object)return r===Object.prototype?{}:s(r);if(~i.call(u).indexOf("[native code]"))try{return new u}catch{}return s(r)}e(S,"getCleanClone");function p(r){var u="";return r.global&&(u+="g"),r.ignoreCase&&(u+="i"),r.multiline&&(u+="m"),r.unicode&&(u+="u"),r.sticky&&(u+="y"),u}e(p,"getRegExpFlagsLegacy");function E(r){return r.flags}e(E,"getRegExpFlagsModern");var _=/test/g.flags==="g"?E:p;function a(r){var u=f.call(r);return u.substring(8,u.length-1)}e(a,"getTagLegacy");function h(r){return r[Symbol.toStringTag]||a(r)}e(h,"getTagModern");var t=typeof Symbol<"u"?h:a,l=Object.defineProperty,m=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,O=Object.getOwnPropertySymbols,d=Object.prototype,T=d.hasOwnProperty,b=d.propertyIsEnumerable,L=typeof O=="function";function j(r){return c(r).concat(O(r))}e(j,"getStrictPropertiesModern");var w=L?j:c;function C(r,u,D){for(var A=w(r),$=0,R=A.length,P=void 0,x=void 0;$<R;++$)if(P=A[$],!(P==="callee"||P==="caller")){if(x=m(r,P),!x){u[P]=D.copier(r[P],D);continue}!x.get&&!x.set&&(x.value=D.copier(x.value,D));try{l(u,P,x)}catch{u[P]=x.value}}return u}e(C,"copyOwnPropertiesStrict");function K(r,u){var D=new u.Constructor;u.cache.set(r,D);for(var A=0,$=r.length;A<$;++A)D[A]=u.copier(r[A],u);return D}e(K,"copyArrayLoose");function H(r,u){var D=new u.Constructor;return u.cache.set(r,D),C(r,D,u)}e(H,"copyArrayStrict");function F(r,u){return r.slice(0)}e(F,"copyArrayBuffer");function q(r,u){return r.slice(0,r.size,r.type)}e(q,"copyBlob");function U(r,u){return new u.Constructor(F(r.buffer))}e(U,"copyDataView");function B(r,u){return new u.Constructor(r.getTime())}e(B,"copyDate");function g(r,u){var D=new u.Constructor;return u.cache.set(r,D),r.forEach(function(A,$){D.set($,u.copier(A,u))}),D}e(g,"copyMapLoose");function ye(r,u){return C(r,g(r,u),u)}e(ye,"copyMapStrict");function pe(r,u){var D=S(u.prototype);u.cache.set(r,D);for(var A in r)T.call(r,A)&&(D[A]=u.copier(r[A],u));return D}e(pe,"copyObjectLooseLegacy");function me(r,u){var D=S(u.prototype);u.cache.set(r,D);for(var A in r)T.call(r,A)&&(D[A]=u.copier(r[A],u));for(var $=O(r),R=0,P=$.length,x=void 0;R<P;++R)x=$[R],b.call(r,x)&&(D[x]=u.copier(r[x],u));return D}e(me,"copyObjectLooseModern");var de=L?me:pe;function ge(r,u){var D=S(u.prototype);return u.cache.set(r,D),C(r,D,u)}e(ge,"copyObjectStrict");function G(r,u){return new u.Constructor(r.valueOf())}e(G,"copyPrimitiveWrapper");function he(r,u){var D=new u.Constructor(r.source,_(r));return D.lastIndex=r.lastIndex,D}e(he,"copyRegExp");function V(r,u){return r}e(V,"copySelf");function re(r,u){var D=new u.Constructor;return u.cache.set(r,D),r.forEach(function(A){D.add(u.copier(A,u))}),D}e(re,"copySetLoose");function ve(r,u){return C(r,re(r,u),u)}e(ve,"copySetStrict");var _e=Array.isArray,z=Object.assign,Oe=Object.getPrototypeOf||function(r){return r.__proto__},te={array:K,arrayBuffer:F,blob:q,dataView:U,date:B,error:V,map:g,object:de,regExp:he,set:re},be=z({},te,{array:H,map:ye,object:ge,set:ve});function Le(r){return{Arguments:r.object,Array:r.array,ArrayBuffer:r.arrayBuffer,Blob:r.blob,Boolean:G,DataView:r.dataView,Date:r.date,Error:r.error,Float32Array:r.arrayBuffer,Float64Array:r.arrayBuffer,Int8Array:r.arrayBuffer,Int16Array:r.arrayBuffer,Int32Array:r.arrayBuffer,Map:r.map,Number:G,Object:r.object,Promise:V,RegExp:r.regExp,Set:r.set,String:G,WeakMap:V,WeakSet:V,Uint8Array:r.arrayBuffer,Uint8ClampedArray:r.arrayBuffer,Uint16Array:r.arrayBuffer,Uint32Array:r.arrayBuffer,Uint64Array:r.arrayBuffer}}e(Le,"getTagSpecificCopiers");function k(r){var u=z({},te,r),D=Le(u),A=D.Array,$=D.Object;function R(P,x){if(x.prototype=x.Constructor=void 0,!P||typeof P!="object")return P;if(x.cache.has(P))return x.cache.get(P);if(x.prototype=Oe(P),x.Constructor=x.prototype&&x.prototype.constructor,!x.Constructor||x.Constructor===Object)return $(P,x);if(_e(P))return A(P,x);var Z=D[t(P)];return Z?Z(P,x):typeof P.then=="function"?P:$(P,x)}return e(R,"copier"),e(function(x){return R(x,{Constructor:void 0,cache:v(),copier:R,prototype:void 0})},"copy")}e(k,"createCopier");function ne(r){return k(z({},be,r))}e(ne,"createStrictCopier");var Ee=ne({}),Se=k({});M.copyStrict=Ee,M.createCopier=k,M.createStrictCopier=ne,M.default=Se}}),He=N({"lib/utils/delete-log-property.js"(M,i){"use strict";i.exports=y;var s=J(),f=ae();function y(n,o){let v=f(o),S=v.pop();n=s(n,v),n!==null&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,S)&&delete n[S]}e(y,"deleteLogProperty")}}),qe=N({"lib/utils/filter-log.js"(M,i){"use strict";i.exports=n;var{createCopier:s}=Ke(),f=s({}),y=He();function n({log:o,context:v}){let{ignoreKeys:S,includeKeys:p}=v,E=f(o);if(p){let _={};return p.forEach(a=>{_[a]=E[a]}),_}return S.forEach(_=>{y(E,_)}),E}e(n,"filterLog")}}),Be=N({"lib/pretty.js"(M,i){i.exports=l;var s=je(),f=oe(),y=xe(),n=Pe(),o=Ae(),v=Ce(),S=se(),p=Re(),E=qe(),{LEVELS:_,LEVEL_KEY:a,LEVEL_NAMES:h}=W(),t=e(m=>{try{return{value:s.parse(m,{protoAction:"remove"})}}catch(c){return{err:c}}},"jsonParser");function l(m){let c;if(f(m))c=m;else{let j=t(m);if(j.err||!f(j.value))return m+this.EOL;c=j.value}if(this.minimumLevel){let j;this.useOnlyCustomProps?j=this.customLevels:j=this.customLevelNames[this.minimumLevel]!==void 0;let w;if(j?w=this.customLevelNames[this.minimumLevel]:w=h[this.minimumLevel],w||(w=typeof this.minimumLevel=="string"?h[this.minimumLevel]:h[_[this.minimumLevel].toLowerCase()]),c[this.levelKey===void 0?a:this.levelKey]<w)return}let O=o({log:c,context:this.context});(this.ignoreKeys||this.includeKeys)&&(c=E({log:c,context:this.context}));let d=n({log:c,context:{...this.context,...this.context.customProperties}}),T=v({log:c,context:this.context}),b=p({log:c,context:this.context}),L="";if(this.levelFirst&&d&&(L=`${d}`),b&&L===""?L=`${b}`:b&&(L=`${L} ${b}`),!this.levelFirst&&d&&(L.length>0?L=`${L} ${d}`:L=d),T&&(L.length>0?L=`${L} ${T}:`:L=T),L.endsWith(":")===!1&&L!==""&&(L+=":"),O!==void 0&&(L.length>0?L=`${L} ${O}`:L=O),L.length>0&&!this.singleLine&&(L+=this.EOL),c.type==="Error"&&c.stack){let j=y({log:c,context:this.context});this.singleLine&&(L+=this.EOL),L+=j}else if(this.hideObject===!1){let j=[this.messageKey,this.levelKey,this.timestampKey].filter(C=>typeof c[C]=="string"||typeof c[C]=="number"||typeof c[C]=="boolean"),w=S({log:c,skipKeys:j,context:this.context});this.singleLine&&!/^\s$/.test(w)&&(L+=" "),L+=w}return L}e(l,"pretty")}}),ce=Be();function Ue(M){let i=Object.assign({},{EOL:`
`,IDENT:"    "},M);return ce.bind({...i,context:i})}e(Ue,"prettyFactory");var fe=Ue({colorizer:M=>M,colorize:!1,colorizeObjects:!1,crlf:!1,customColors:null,customLevels:null,customPrettifiers:{time:M=>`${M}`},errorLikeObjectKeys:["err","error"],errorProps:"",hideObject:!1,ignore:"hostname,pid,buildId,project_id",include:void 0,levelFirst:!1,levelKey:"level",levelLabel:"levelLabel",messageFormat:"",messageKey:"msg",minimumLevel:void 0,singleLine:!1,timestampKey:"timestamp",translateTime:"SYS:HH:MM:ss",useOnlyCustomProps:!0}),Y=class extends I.handlers.BaseHandler{static{e(this,"ConsoleHandler")}format(i){try{let s=JSON.parse(i.msg);return s.level=i.levelName,s.timestamp||(s.timestamp=i.datetime),delete s.hostname,fe(s)}catch{return`${ie(i.datetime,"HH:mm:ss")} ${i.levelName}: ${fe(i.msg)}`}}log(i){console.log(i)}};await I.setup({handlers:{console:new Y("DEBUG")},loggers:{default:{level:"DEBUG",handlers:["console"]}}});var Q=class{static{e(this,"DefaultConsoleAdapter")}debug(...i){i.forEach(s=>{console.debug(JSON.stringify(s,null,2))})}info(...i){i.forEach(s=>{console.info(JSON.stringify(s,null,2))})}log(...i){i.forEach(s=>{console.log(JSON.stringify(s,null,2))})}warn(...i){i.forEach(s=>{console.warn(JSON.stringify(s,null,2))})}error(...i){i.forEach(s=>{console.error(JSON.stringify(s,null,2))})}},ee=class{static{e(this,"LocalConsoleAdapter")}debug(...i){i.forEach(s=>{I.debug(s)})}info(...i){i.forEach(s=>{I.info(s)})}log(...i){i.forEach(s=>{I.info(s)})}warn(...i){i.forEach(s=>{I.warning(s)})}error(...i){i.forEach(s=>{I.error(s)})}},Vr=new Q,le=new ee;var We="system-logger";globalThis.__ZUPLO_SERVICE_PROVIDER&&globalThis.__ZUPLO_SERVICE_PROVIDER.addService(We,{logger:le,captureUserLogs:!0});export{We as SYSTEM_LOGGER};
