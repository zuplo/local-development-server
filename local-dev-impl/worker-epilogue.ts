var De=Object.defineProperty;var e=(s,t)=>De(s,"name",{value:t,configurable:!0});import{bundle as sr,transpile as ar}from"https://deno.land/x/emit@0.29.0/mod.ts";import{load as cr}from"https://deno.land/std@0.203.0/dotenv/mod.ts";import{createOAuth2Token as fr}from"https://deno.land/x/deno_gcp_admin@0.0.5/auth.ts";import{parse as mr}from"https://deno.land/std@0.203.0/flags/mod.ts";import{Server as pr}from"https://deno.land/std@0.203.0/http/server.ts";import*as gr from"https://deno.land/std@0.203.0/fs/mod.ts";import*as hr from"https://deno.land/std@0.203.0/http/http_status.ts";import*as U from"https://deno.land/std@0.203.0/log/mod.ts";import*as vr from"https://deno.land/std@0.203.0/path/mod.ts";import{deferred as _r}from"https://deno.land/std@0.203.0/async/deferred.ts";import{assert as Er,assertAlmostEquals as Lr,assertArrayIncludes as Sr,assertEquals as Mr,assertExists as wr,assertFalse as jr,assertInstanceOf as Cr,assertIsError as Tr,assertMatch as Dr,assertNotEquals as Br,assertNotMatch as Nr,assertNotStrictEquals as Pr,assertObjectMatch as Ar,assertRejects as xr,assertStrictEquals as Rr,assertStringIncludes as Fr,assertThrows as Ir,equal as Kr,fail as $r,unimplemented as qr,unreachable as Hr}from"https://deno.land/std@0.203.0/assert/mod.ts";import{afterAll as Wr,afterEach as Ur,beforeAll as Gr,beforeEach as Yr,describe as zr,it as kr}from"https://deno.land/std@0.203.0/testing/bdd.ts";var Be=Object.getOwnPropertyNames,A=e((s,t)=>e(function(){return t||(0,s[Be(s)[0]])((t={exports:{}}).exports,t),t.exports},"__require"),"__commonJS"),Ne=A({"node_modules/secure-json-parse/index.js"(s,t){"use strict";var o=typeof Buffer<"u",c=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,a=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function i(h,w,E){E==null&&w!==null&&typeof w=="object"&&(E=w,w=void 0),o&&Buffer.isBuffer(h)&&(h=h.toString()),h&&h.charCodeAt(0)===65279&&(h=h.slice(1));let f=JSON.parse(h,w);if(f===null||typeof f!="object")return f;let L=E&&E.protoAction||"error",r=E&&E.constructorAction||"error";if(L==="ignore"&&r==="ignore")return f;if(L!=="ignore"&&r!=="ignore"){if(c.test(h)===!1&&a.test(h)===!1)return f}else if(L!=="ignore"&&r==="ignore"){if(c.test(h)===!1)return f}else if(a.test(h)===!1)return f;return u(f,{protoAction:L,constructorAction:r,safe:E&&E.safe})}e(i,"_parse");function u(h,{protoAction:w="error",constructorAction:E="error",safe:f}={}){let L=[h];for(;L.length;){let r=L;L=[];for(let p of r){if(w!=="ignore"&&Object.prototype.hasOwnProperty.call(p,"__proto__")){if(f===!0)return null;if(w==="error")throw new SyntaxError("Object contains forbidden prototype property");delete p.__proto__}if(E!=="ignore"&&Object.prototype.hasOwnProperty.call(p,"constructor")&&Object.prototype.hasOwnProperty.call(p.constructor,"prototype")){if(f===!0)return null;if(E==="error")throw new SyntaxError("Object contains forbidden prototype property");delete p.constructor}for(let g in p){let m=p[g];m&&typeof m=="object"&&L.push(m)}}}return h}e(u,"filter");function l(h,w,E){let f=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(h,w,E)}finally{Error.stackTraceLimit=f}}e(l,"parse");function O(h,w){let E=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(h,w,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=E}}e(O,"safeParse"),t.exports=l,t.exports.default=l,t.exports.parse=l,t.exports.safeParse=O,t.exports.scan=u}}),Oe=A({"lib/utils/is-object.js"(s,t){"use strict";t.exports=o;function o(c){return Object.prototype.toString.apply(c)==="[object Object]"}e(o,"isObject")}}),re=A({"lib/constants.js"(s,t){"use strict";t.exports={DATE_FORMAT:"yyyy-mm-dd HH:MM:ss.l o",DATE_FORMAT_SIMPLE:"HH:MM:ss.l",ERROR_LIKE_KEYS:["err","error"],MESSAGE_KEY:"msg",LEVEL_KEY:"level",LEVEL_LABEL:"levelLabel",TIMESTAMP_KEY:"time",LEVELS:{default:"USERLVL",60:"FATAL",50:"ERROR",40:"WARN",30:"INFO",20:"DEBUG",10:"TRACE"},LEVEL_NAMES:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},LOGGER_KEYS:["pid","hostname","name","level","time","timestamp","caller"]}}}),he=A({"lib/utils/join-lines-with-indentation.js"(s,t){"use strict";t.exports=o;function o({input:c,ident:a="    ",eol:i=`
`}){let u=c.split(/\r?\n/);for(let l=1;l<u.length;l+=1)u[l]=a+u[l];return u.join(i)}e(o,"joinLinesWithIndentation")}}),Pe=A({"node_modules/fast-safe-stringify/index.js"(s,t){t.exports=l,l.default=l,l.stable=E,l.stableStringify=E;var o="[...]",c="[Circular]",a=[],i=[];function u(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}e(u,"defaultOptions");function l(r,p,g,m){typeof m>"u"&&(m=u()),h(r,"",0,[],void 0,0,m);var b;try{i.length===0?b=JSON.stringify(r,p,g):b=JSON.stringify(r,L(p),g)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;a.length!==0;){var _=a.pop();_.length===4?Object.defineProperty(_[0],_[1],_[3]):_[0][_[1]]=_[2]}}return b}e(l,"stringify");function O(r,p,g,m){var b=Object.getOwnPropertyDescriptor(m,g);b.get!==void 0?b.configurable?(Object.defineProperty(m,g,{value:r}),a.push([m,g,p,b])):i.push([p,g,r]):(m[g]=r,a.push([m,g,p]))}e(O,"setReplace");function h(r,p,g,m,b,_,C){_+=1;var M;if(typeof r=="object"&&r!==null){for(M=0;M<m.length;M++)if(m[M]===r){O(c,r,p,b);return}if(typeof C.depthLimit<"u"&&_>C.depthLimit){O(o,r,p,b);return}if(typeof C.edgesLimit<"u"&&g+1>C.edgesLimit){O(o,r,p,b);return}if(m.push(r),Array.isArray(r))for(M=0;M<r.length;M++)h(r[M],M,M,m,r,_,C);else{var d=Object.keys(r);for(M=0;M<d.length;M++){var v=d[M];h(r[v],v,M,m,r,_,C)}}m.pop()}}e(h,"decirc");function w(r,p){return r<p?-1:r>p?1:0}e(w,"compareFunction");function E(r,p,g,m){typeof m>"u"&&(m=u());var b=f(r,"",0,[],void 0,0,m)||r,_;try{i.length===0?_=JSON.stringify(b,p,g):_=JSON.stringify(b,L(p),g)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;a.length!==0;){var C=a.pop();C.length===4?Object.defineProperty(C[0],C[1],C[3]):C[0][C[1]]=C[2]}}return _}e(E,"deterministicStringify");function f(r,p,g,m,b,_,C){_+=1;var M;if(typeof r=="object"&&r!==null){for(M=0;M<m.length;M++)if(m[M]===r){O(c,r,p,b);return}try{if(typeof r.toJSON=="function")return}catch{return}if(typeof C.depthLimit<"u"&&_>C.depthLimit){O(o,r,p,b);return}if(typeof C.edgesLimit<"u"&&g+1>C.edgesLimit){O(o,r,p,b);return}if(m.push(r),Array.isArray(r))for(M=0;M<r.length;M++)f(r[M],M,M,m,r,_,C);else{var d={},v=Object.keys(r).sort(w);for(M=0;M<v.length;M++){var j=v[M];f(r[j],j,M,m,r,_,C),d[j]=r[j]}if(typeof b<"u")a.push([b,p,r]),b[p]=d;else return d}m.pop()}}e(f,"deterministicDecirc");function L(r){return r=typeof r<"u"?r:function(p,g){return g},function(p,g){if(i.length>0)for(var m=0;m<i.length;m++){var b=i[m];if(b[1]===p&&b[0]===g){g=b[2],i.splice(m,1);break}}return r.call(this,p,g)}}e(L,"replaceGetterValues")}}),Ae=A({"lib/utils/prettify-error.js"(s,t){"use strict";t.exports=c;var o=he();function c({keyName:a,lines:i,eol:u,ident:l}){let O="",h=o({input:i,ident:l,eol:u}),w=`${l}${a}: ${h}${u}`.split(u);for(let E=0;E<w.length;E+=1){E!==0&&(O+=u);let f=w[E];if(/^\s*"stack"/.test(f)){let L=/^(\s*"stack":)\s*(".*"),?$/.exec(f);if(L&&L.length===3){let r=/^\s*/.exec(f)[0].length+4,p=" ".repeat(r),g=L[2];O+=L[1]+u+p+JSON.parse(g).replace(/\n/g,u+p)}else O+=f}else O+=f}return O}e(c,"prettifyError")}}),Ee=A({"lib/utils/prettify-object.js"(s,t){"use strict";t.exports=u;var{LOGGER_KEYS:o}=re(),c=Pe(),a=he(),i=Ae();function u({log:l,excludeLoggerKeys:O=!0,skipKeys:h=[],context:w}){let{EOL:E,IDENT:f,customPrettifiers:L,errorLikeObjectKeys:r,objectColorizer:p,singleLine:g}=w,m=[].concat(h);O===!0&&Array.prototype.push.apply(m,o);let b="",{plain:_,errors:C}=Object.entries(l).reduce(({plain:M,errors:d},[v,j])=>{if(m.includes(v)===!1){let T=typeof L[v]=="function"?L[v](j,v,l):j;r.includes(v)?d[v]=T:M[v]=T}return{plain:M,errors:d}},{plain:{},errors:{}});return g?(Object.keys(_).length>0&&(b+=p.greyMessage(c(_))),b+=E,b=b.replace(/\\\\/gi,"\\")):Object.entries(_).forEach(([M,d])=>{let v=typeof L[M]=="function"?d:c(d,null,2);if(v===void 0)return;v=v.replace(/\\\\/gi,"\\");let j=a({input:v,ident:f,eol:E});b+=`${f}${M}:${j.startsWith(E)?"":" "}${j}${E}`}),Object.entries(C).forEach(([M,d])=>{let v=typeof L[M]=="function"?d:c(d,null,2);v!==void 0&&(b+=i({keyName:M,lines:v,eol:E,ident:f}))}),b}e(u,"prettifyObject")}}),xe=A({"lib/utils/prettify-error-log.js"(s,t){"use strict";t.exports=u;var{LOGGER_KEYS:o}=re(),c=Oe(),a=he(),i=Ee();function u({log:l,context:O}){let{EOL:h,IDENT:w,errorProps:E,messageKey:f}=O,L=l.stack,r=a({input:L,ident:w,eol:h}),p=`${w}${r}${h}`;if(E.length>0){let g=o.concat(f,"type","stack"),m;E[0]==="*"?m=Object.keys(l).filter(b=>g.includes(b)===!1):m=E.filter(b=>g.includes(b)===!1);for(let b=0;b<m.length;b+=1){let _=m[b];if(_ in l){if(c(l[_])){let C=i({log:l[_],excludeLoggerKeys:!1,context:{...O,IDENT:w+w}});p=`${p}${w}${_}: {${h}${C}${w}}${h}`;continue}p=`${p}${w}${_}: ${l[_]}${h}`}}}return p}e(u,"prettifyErrorLog")}}),Le=A({"lib/utils/split-property-key.js"(s,t){"use strict";t.exports=o;function o(c){let a=[],i=!1,u="";for(let l=0;l<c.length;l++){let O=c.charAt(l);if(O==="\\"){i=!0;continue}if(i){i=!1,u+=O;continue}if(O==="."){a.push(u),u="";continue}u+=O}return u.length&&a.push(u),a}e(o,"splitPropertyKey")}}),se=A({"lib/utils/get-property-value.js"(s,t){"use strict";t.exports=c;var o=Le();function c(a,i){let u=Array.isArray(i)?i:o(i);for(let l of u){if(!Object.prototype.hasOwnProperty.call(a,l))return;a=a[l]}return a}e(c,"getPropertyValue")}}),Re=A({"lib/utils/prettify-level.js"(s,t){"use strict";t.exports=c;var o=se();function c({log:a,context:i}){let{colorizer:u,customLevels:l,customLevelNames:O,levelKey:h}=i,w=i.customPrettifiers?.level,E=o(a,h);if(E!==void 0)return w?w(E):u(E,{customLevels:l,customLevelNames:O})}e(c,"prettifyLevel")}}),Fe=A({"lib/utils/interpret-conditionals.js"(s,t){"use strict";t.exports=c;var o=se();function c(a,i){return a=a.replace(/{if (.*?)}(.*?){end}/g,u),a=a.replace(/{if (.*?)}/g,""),a=a.replace(/{end}/g,""),a.replace(/\s+/g," ").trim();function u(l,O,h){let w=o(i,O);return w&&h.includes(O)?h.replace(new RegExp("{"+O+"}","g"),w):""}e(u,"replacer")}e(c,"interpretConditionals")}}),Ie=A({"lib/utils/prettify-message.js"(s,t){"use strict";t.exports=i;var{LEVELS:o}=re(),c=se(),a=Fe();function i({log:u,context:l}){let{colorizer:O,customLevels:h,levelKey:w,levelLabel:E,messageFormat:f,messageKey:L,useOnlyCustomProps:r}=l;if(f&&typeof f=="string"){let p=a(f,u),g=String(p).replace(/{([^{}]+)}/g,function(m,b){let _;return b===E&&(_=c(u,w))!==void 0?(r?h===void 0:h[_]===void 0)?o[_]:h[_]:c(u,b)||""});return O.message(g)}if(f&&typeof f=="function"){let p=f(u,L,E);return O.message(p)}if(L in u&&!(typeof u[L]!="string"&&typeof u[L]!="number"&&typeof u[L]!="boolean"))return O.message(u[L])}e(i,"prettifyMessage")}}),Ke=A({"lib/utils/prettify-metadata.js"(s,t){"use strict";t.exports=o;function o({log:c,context:a}){let i=a.customPrettifiers,u="";if(c.name||c.pid||c.hostname){if(u+="(",c.name&&(u+=i.name?i.name(c.name):c.name),c.pid){let l=i.pid?i.pid(c.pid):c.pid;c.name&&c.pid?u+="/"+l:u+=l}c.hostname&&(u+=`${u==="("?"on":" on"} ${i.hostname?i.hostname(c.hostname):c.hostname}`),u+=")"}if(c.caller&&(u+=`${u===""?"":" "}<${i.caller?i.caller(c.caller):c.caller}>`),u!=="")return u}e(o,"prettifyMetadata")}}),$e=A({"node_modules/dateformat/lib/dateformat.js"(s,t){"use strict";function o(c){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=e(function(i){return typeof i},"_typeof2"):o=e(function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},"_typeof2"),o(c)}e(o,"_typeof"),function(c){var a=arguments,i=function(){var E=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,f=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,L=/[^-+\dA-Z]/g;return function(r,p,g,m){if(a.length===1&&w(r)==="string"&&!/\d/.test(r)&&(p=r,r=void 0),r=r||r===0?r:new Date,r instanceof Date||(r=new Date(r)),isNaN(r))throw TypeError("Invalid date");p=String(i.masks[p]||p||i.masks.default);var b=p.slice(0,4);(b==="UTC:"||b==="GMT:")&&(p=p.slice(4),g=!0,b==="GMT:"&&(m=!0));var _=e(function(){return g?"getUTC":"get"},"_2"),C=e(function(){return r[_()+"Date"]()},"d"),M=e(function(){return r[_()+"Day"]()},"D2"),d=e(function(){return r[_()+"Month"]()},"m"),v=e(function(){return r[_()+"FullYear"]()},"y2"),j=e(function(){return r[_()+"Hours"]()},"H"),T=e(function(){return r[_()+"Minutes"]()},"M"),R=e(function(){return r[_()+"Seconds"]()},"s"),F=e(function(){return r[_()+"Milliseconds"]()},"L"),I=e(function(){return g?0:r.getTimezoneOffset()},"o"),K=e(function(){return O(r)},"W"),q=e(function(){return h(r)},"N"),V={d:e(function(){return C()},"d"),dd:e(function(){return u(C())},"dd"),ddd:e(function(){return i.i18n.dayNames[M()]},"ddd"),DDD:e(function(){return l({y:v(),m:d(),d:C(),_:_(),dayName:i.i18n.dayNames[M()],short:!0})},"DDD"),dddd:e(function(){return i.i18n.dayNames[M()+7]},"dddd"),DDDD:e(function(){return l({y:v(),m:d(),d:C(),_:_(),dayName:i.i18n.dayNames[M()+7]})},"DDDD"),m:e(function(){return d()+1},"m"),mm:e(function(){return u(d()+1)},"mm"),mmm:e(function(){return i.i18n.monthNames[d()]},"mmm"),mmmm:e(function(){return i.i18n.monthNames[d()+12]},"mmmm"),yy:e(function(){return String(v()).slice(2)},"yy"),yyyy:e(function(){return u(v(),4)},"yyyy"),h:e(function(){return j()%12||12},"h"),hh:e(function(){return u(j()%12||12)},"hh"),H:e(function(){return j()},"H"),HH:e(function(){return u(j())},"HH"),M:e(function(){return T()},"M"),MM:e(function(){return u(T())},"MM"),s:e(function(){return R()},"s"),ss:e(function(){return u(R())},"ss"),l:e(function(){return u(F(),3)},"l"),L:e(function(){return u(Math.floor(F()/10))},"L"),t:e(function(){return j()<12?i.i18n.timeNames[0]:i.i18n.timeNames[1]},"t"),tt:e(function(){return j()<12?i.i18n.timeNames[2]:i.i18n.timeNames[3]},"tt"),T:e(function(){return j()<12?i.i18n.timeNames[4]:i.i18n.timeNames[5]},"T"),TT:e(function(){return j()<12?i.i18n.timeNames[6]:i.i18n.timeNames[7]},"TT"),Z:e(function(){return m?"GMT":g?"UTC":(String(r).match(f)||[""]).pop().replace(L,"").replace(/GMT\+0000/g,"UTC")},"Z"),o:e(function(){return(I()>0?"-":"+")+u(Math.floor(Math.abs(I())/60)*100+Math.abs(I())%60,4)},"o"),p:e(function(){return(I()>0?"-":"+")+u(Math.floor(Math.abs(I())/60),2)+":"+u(Math.floor(Math.abs(I())%60),2)},"p"),S:e(function(){return["th","st","nd","rd"][C()%10>3?0:(C()%100-C()%10!=10)*C()%10]},"S"),W:e(function(){return K()},"W"),WW:e(function(){return u(K())},"WW"),N:e(function(){return q()},"N")};return p.replace(E,function(S){return S in V?V[S]():S.slice(1,S.length-1)})}}();i.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},i.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]};var u=e(function(f,L){for(f=String(f),L=L||2;f.length<L;)f="0"+f;return f},"pad2"),l=e(function(f){var L=f.y,r=f.m,p=f.d,g=f._,m=f.dayName,b=f.short,_=b===void 0?!1:b,C=new Date,M=new Date;M.setDate(M[g+"Date"]()-1);var d=new Date;d.setDate(d[g+"Date"]()+1);var v=e(function(){return C[g+"Date"]()},"today_d2"),j=e(function(){return C[g+"Month"]()},"today_m2"),T=e(function(){return C[g+"FullYear"]()},"today_y2"),R=e(function(){return M[g+"Date"]()},"yesterday_d2"),F=e(function(){return M[g+"Month"]()},"yesterday_m2"),I=e(function(){return M[g+"FullYear"]()},"yesterday_y2"),K=e(function(){return d[g+"Date"]()},"tomorrow_d2"),q=e(function(){return d[g+"Month"]()},"tomorrow_m2"),V=e(function(){return d[g+"FullYear"]()},"tomorrow_y2");return T()===L&&j()===r&&v()===p?_?"Tdy":"Today":I()===L&&F()===r&&R()===p?_?"Ysd":"Yesterday":V()===L&&q()===r&&K()===p?_?"Tmw":"Tomorrow":m},"getDayName2"),O=e(function(f){var L=new Date(f.getFullYear(),f.getMonth(),f.getDate());L.setDate(L.getDate()-(L.getDay()+6)%7+3);var r=new Date(L.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var p=L.getTimezoneOffset()-r.getTimezoneOffset();L.setHours(L.getHours()-p);var g=(L-r)/(864e5*7);return 1+Math.floor(g)},"getWeek2"),h=e(function(f){var L=f.getDay();return L===0&&(L=7),L},"getDayOfWeek2"),w=e(function(f){return f===null?"null":f===void 0?"undefined":o(f)!=="object"?o(f):Array.isArray(f)?"array":{}.toString.call(f).slice(8,-1).toLowerCase()},"kindOf2");typeof define=="function"&&define.amd?define(function(){return i}):(typeof s>"u"?"undefined":o(s))==="object"?t.exports=i:c.dateFormat=i}(void 0)}}),Se=A({"lib/utils/is-valid-date.js"(s,t){"use strict";t.exports=o;function o(c){return c instanceof Date&&!Number.isNaN(c.getTime())}e(o,"isValidDate")}}),qe=A({"lib/utils/create-date.js"(s,t){"use strict";t.exports=c;var o=Se();function c(a){let i=new Date(a);return o(i)||(i=new Date(+a)),i}e(c,"createDate")}}),He=A({"lib/utils/format-time.js"(s,t){"use strict";t.exports=l;var{DATE_FORMAT:o,DATE_FORMAT_SIMPLE:c}=re(),a=$e(),i=qe(),u=Se();function l(O,h=!1){if(h===!1)return O;let w=i(O);if(!u(w))return O;if(h===!0)return a(w,c);let E=h.toUpperCase();if(E==="SYS:STANDARD")return a(w,o);let f=E.substr(0,4);return f==="SYS:"||f==="UTC:"?f==="UTC:"?a(w,h):a(w,h.slice(4)):a(w,`UTC:${h}`)}e(l,"formatTime")}}),Ve=A({"lib/utils/prettify-time.js"(s,t){"use strict";t.exports=c;var o=He();function c({log:a,context:i}){let{timestampKey:u,translateTime:l}=i,O=i.customPrettifiers?.time,h=null;if(u in a?h=a[u]:"timestamp"in a&&(h=a.timestamp),h===null)return;let w=l?o(h,l):h;return O?O(w):`[${w}]`}e(c,"prettifyTime")}}),We=A({"node_modules/fast-copy/dist/cjs/index.cjs"(s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t=Function.prototype.toString,o=Object.create,c=Object.prototype.toString,a=function(){function n(){this._keys=[],this._values=[]}return e(n,"LegacyCache2"),n.prototype.has=function(y){return!!~this._keys.indexOf(y)},n.prototype.get=function(y){return this._values[this._keys.indexOf(y)]},n.prototype.set=function(y,D){this._keys.push(y),this._values.push(D)},n}();function i(){return new a}e(i,"createCacheLegacy");function u(){return new WeakMap}e(u,"createCacheModern");var l=typeof WeakMap<"u"?u:i;function O(n){if(!n)return o(null);var y=n.constructor;if(y===Object)return n===Object.prototype?{}:o(n);if(~t.call(y).indexOf("[native code]"))try{return new y}catch{}return o(n)}e(O,"getCleanClone");function h(n){var y="";return n.global&&(y+="g"),n.ignoreCase&&(y+="i"),n.multiline&&(y+="m"),n.unicode&&(y+="u"),n.sticky&&(y+="y"),y}e(h,"getRegExpFlagsLegacy");function w(n){return n.flags}e(w,"getRegExpFlagsModern");var E=/test/g.flags==="g"?w:h;function f(n){var y=c.call(n);return y.substring(8,y.length-1)}e(f,"getTagLegacy");function L(n){return n[Symbol.toStringTag]||f(n)}e(L,"getTagModern");var r=typeof Symbol<"u"?L:f,p=Object.defineProperty,g=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,_=Object.prototype,C=_.hasOwnProperty,M=_.propertyIsEnumerable,d=typeof b=="function";function v(n){return m(n).concat(b(n))}e(v,"getStrictPropertiesModern");var j=d?v:m;function T(n,y,D){for(var P=j(n),$=0,x=P.length,N=void 0,B=void 0;$<x;++$)if(N=P[$],!(N==="callee"||N==="caller")){if(B=g(n,N),!B){y[N]=D.copier(n[N],D);continue}!B.get&&!B.set&&(B.value=D.copier(B.value,D));try{p(y,N,B)}catch{y[N]=B.value}}return y}e(T,"copyOwnPropertiesStrict");function R(n,y){var D=new y.Constructor;y.cache.set(n,D);for(var P=0,$=n.length;P<$;++P)D[P]=y.copier(n[P],y);return D}e(R,"copyArrayLoose");function F(n,y){var D=new y.Constructor;return y.cache.set(n,D),T(n,D,y)}e(F,"copyArrayStrict");function I(n,y){return n.slice(0)}e(I,"copyArrayBuffer");function K(n,y){return n.slice(0,n.size,n.type)}e(K,"copyBlob");function q(n,y){return new y.Constructor(I(n.buffer))}e(q,"copyDataView");function V(n,y){return new y.Constructor(n.getTime())}e(V,"copyDate");function S(n,y){var D=new y.Constructor;return y.cache.set(n,D),n.forEach(function(P,$){D.set($,y.copier(P,y))}),D}e(S,"copyMapLoose");function Z(n,y){return T(n,S(n,y),y)}e(Z,"copyMapStrict");function G(n,y){var D=O(y.prototype);y.cache.set(n,D);for(var P in n)C.call(n,P)&&(D[P]=y.copier(n[P],y));return D}e(G,"copyObjectLooseLegacy");function X(n,y){var D=O(y.prototype);y.cache.set(n,D);for(var P in n)C.call(n,P)&&(D[P]=y.copier(n[P],y));for(var $=b(n),x=0,N=$.length,B=void 0;x<N;++x)B=$[x],M.call(n,B)&&(D[B]=y.copier(n[B],y));return D}e(X,"copyObjectLooseModern");var te=d?X:G;function z(n,y){var D=O(y.prototype);return y.cache.set(n,D),T(n,D,y)}e(z,"copyObjectStrict");function Y(n,y){return new y.Constructor(n.valueOf())}e(Y,"copyPrimitiveWrapper");function ue(n,y){var D=new y.Constructor(n.source,E(n));return D.lastIndex=n.lastIndex,D}e(ue,"copyRegExp");function k(n,y){return n}e(k,"copySelf");function ne(n,y){var D=new y.Constructor;return y.cache.set(n,D),n.forEach(function(P){D.add(y.copier(P,y))}),D}e(ne,"copySetLoose");function ce(n,y){return T(n,ne(n,y),y)}e(ce,"copySetStrict");var le=Array.isArray,Q=Object.assign,fe=Object.getPrototypeOf||function(n){return n.__proto__},ie={array:R,arrayBuffer:I,blob:K,dataView:q,date:V,error:k,map:S,object:te,regExp:ue,set:ne},ye=Q({},ie,{array:F,map:Z,object:z,set:ce});function me(n){return{Arguments:n.object,Array:n.array,ArrayBuffer:n.arrayBuffer,Blob:n.blob,Boolean:Y,DataView:n.dataView,Date:n.date,Error:n.error,Float32Array:n.arrayBuffer,Float64Array:n.arrayBuffer,Int8Array:n.arrayBuffer,Int16Array:n.arrayBuffer,Int32Array:n.arrayBuffer,Map:n.map,Number:Y,Object:n.object,Promise:k,RegExp:n.regExp,Set:n.set,String:Y,WeakMap:k,WeakSet:k,Uint8Array:n.arrayBuffer,Uint8ClampedArray:n.arrayBuffer,Uint16Array:n.arrayBuffer,Uint32Array:n.arrayBuffer,Uint64Array:n.arrayBuffer}}e(me,"getTagSpecificCopiers");function ee(n){var y=Q({},ie,n),D=me(y),P=D.Array,$=D.Object;function x(N,B){if(B.prototype=B.Constructor=void 0,!N||typeof N!="object")return N;if(B.cache.has(N))return B.cache.get(N);if(B.prototype=fe(N),B.Constructor=B.prototype&&B.prototype.constructor,!B.Constructor||B.Constructor===Object)return $(N,B);if(le(N))return P(N,B);var H=D[r(N)];return H?H(N,B):typeof N.then=="function"?N:$(N,B)}return e(x,"copier"),e(function(B){return x(B,{Constructor:void 0,cache:l(),copier:x,prototype:void 0})},"copy")}e(ee,"createCopier");function oe(n){return ee(Q({},ye,n))}e(oe,"createStrictCopier");var de=oe({}),pe=ee({});s.copyStrict=de,s.createCopier=ee,s.createStrictCopier=oe,s.default=pe}}),Ue=A({"lib/utils/delete-log-property.js"(s,t){"use strict";t.exports=a;var o=se(),c=Le();function a(i,u){let l=c(u),O=l.pop();i=o(i,l),i!==null&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,O)&&delete i[O]}e(a,"deleteLogProperty")}}),Ge=A({"lib/utils/filter-log.js"(s,t){"use strict";t.exports=i;var{createCopier:o}=We(),c=o({}),a=Ue();function i({log:u,context:l}){let{ignoreKeys:O,includeKeys:h}=l,w=c(u);if(h){let E={};return h.forEach(f=>{E[f]=w[f]}),E}return O.forEach(E=>{a(w,E)}),w}e(i,"filterLog")}}),Ye=A({"lib/pretty.js"(s,t){t.exports=p;var o=Ne(),c=Oe(),a=xe(),i=Re(),u=Ie(),l=Ke(),O=Ee(),h=Ve(),w=Ge(),{LEVELS:E,LEVEL_KEY:f,LEVEL_NAMES:L}=re(),r=e(g=>{try{return{value:o.parse(g,{protoAction:"remove"})}}catch(m){return{err:m}}},"jsonParser");function p(g){let m;if(c(g))m=g;else{let v=r(g);if(v.err||!c(v.value))return g+this.EOL;m=v.value}if(this.minimumLevel){let v;this.useOnlyCustomProps?v=this.customLevels:v=this.customLevelNames[this.minimumLevel]!==void 0;let j;if(v?j=this.customLevelNames[this.minimumLevel]:j=L[this.minimumLevel],j||(j=typeof this.minimumLevel=="string"?L[this.minimumLevel]:L[E[this.minimumLevel].toLowerCase()]),m[this.levelKey===void 0?f:this.levelKey]<j)return}let b=u({log:m,context:this.context});(this.ignoreKeys||this.includeKeys)&&(m=w({log:m,context:this.context}));let _=i({log:m,context:{...this.context,...this.context.customProperties}}),C=l({log:m,context:this.context}),M=h({log:m,context:this.context}),d="";if(this.levelFirst&&_&&(d=`${_}`),M&&d===""?d=`${M}`:M&&(d=`${d} ${M}`),!this.levelFirst&&_&&(d.length>0?d=`${d} ${_}`:d=_),C&&(d.length>0?d=`${d} ${C}:`:d=C),d.endsWith(":")===!1&&d!==""&&(d+=":"),b!==void 0&&(d.length>0?d=`${d} ${b}`:d=b),d.length>0&&!this.singleLine&&(d+=this.EOL),m.type==="Error"&&m.stack){let v=a({log:m,context:this.context});this.singleLine&&(d+=this.EOL),d+=v}else if(this.hideObject===!1){let v=[this.messageKey,this.levelKey,this.timestampKey].filter(T=>typeof m[T]=="string"||typeof m[T]=="number"||typeof m[T]=="boolean"),j=O({log:m,skipKeys:v,context:this.context});this.singleLine&&!/^\s$/.test(j)&&(d+=" "),d+=j}return d}e(p,"pretty")}}),Me=Ye();var ze=Object.getOwnPropertyNames;var J=e((s,t)=>e(function(){return t||(0,s[ze(s)[0]])((t={exports:{}}).exports,t),t.exports},"__require2"),"__commonJS"),we=J({"lib/constants.js"(s,t){"use strict";t.exports={DATE_FORMAT:"yyyy-mm-dd HH:MM:ss.l o",DATE_FORMAT_SIMPLE:"HH:MM:ss.l",ERROR_LIKE_KEYS:["err","error"],MESSAGE_KEY:"msg",LEVEL_KEY:"level",LEVEL_LABEL:"levelLabel",TIMESTAMP_KEY:"time",LEVELS:{default:"USERLVL",60:"FATAL",50:"ERROR",40:"WARN",30:"INFO",20:"DEBUG",10:"TRACE"},LEVEL_NAMES:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},LOGGER_KEYS:["pid","hostname","name","level","time","timestamp","caller"]}}}),ke=J({"node_modules/colorette/index.cjs"(s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var{env:t={},argv:o=[],platform:c=""}=typeof process>"u"?{}:process,a="NO_COLOR"in t||o.includes("--no-color"),i="FORCE_COLOR"in t||o.includes("--color"),u=c==="win32",l=t.TERM==="dumb",O=globalThis.Deno&&globalThis.Deno.isatty(1)&&t.TERM&&!l,h="CI"in t&&("GITHUB_ACTIONS"in t||"GITLAB_CI"in t||"CIRCLECI"in t),w=!a&&(i||u&&!l||O||h),E=e((x,N,B,H,W=N.substring(0,x)+H,ge=N.substring(x+B.length),_e=ge.indexOf(B))=>W+(_e<0?ge:E(_e,ge,B,H)),"replaceClose"),f=e((x,N,B,H,W)=>x<0?B+N+H:B+E(x,N,H,W)+H,"clearBleed"),L=e((x,N,B=x,H=x.length+1)=>W=>W||!(W===""||W===void 0)?f((""+W).indexOf(N,H),W,x,N,B):"","filterEmpty"),r=e((x,N,B)=>L(`\x1B[${x}m`,`\x1B[${N}m`,B),"init"),p={reset:r(0,0),bold:r(1,22,"\x1B[22m\x1B[1m"),dim:r(2,22,"\x1B[22m\x1B[2m"),italic:r(3,23),underline:r(4,24),inverse:r(7,27),hidden:r(8,28),strikethrough:r(9,29),black:r(30,39),red:r(31,39),green:r(32,39),yellow:r(33,39),blue:r(34,39),magenta:r(35,39),cyan:r(36,39),white:r(37,39),gray:r(90,39),bgBlack:r(40,49),bgRed:r(41,49),bgGreen:r(42,49),bgYellow:r(43,49),bgBlue:r(44,49),bgMagenta:r(45,49),bgCyan:r(46,49),bgWhite:r(47,49),blackBright:r(90,39),redBright:r(91,39),greenBright:r(92,39),yellowBright:r(93,39),blueBright:r(94,39),magentaBright:r(95,39),cyanBright:r(96,39),whiteBright:r(97,39),bgBlackBright:r(100,49),bgRedBright:r(101,49),bgGreenBright:r(102,49),bgYellowBright:r(103,49),bgBlueBright:r(104,49),bgMagentaBright:r(105,49),bgCyanBright:r(106,49),bgWhiteBright:r(107,49)},g=e(({useColor:x=w}={})=>x?p:Object.keys(p).reduce((N,B)=>({...N,[B]:String}),{}),"createColors"),{reset:m,bold:b,dim:_,italic:C,underline:M,inverse:d,hidden:v,strikethrough:j,black:T,red:R,green:F,yellow:I,blue:K,magenta:q,cyan:V,white:S,gray:Z,bgBlack:G,bgRed:X,bgGreen:te,bgYellow:z,bgBlue:Y,bgMagenta:ue,bgCyan:k,bgWhite:ne,blackBright:ce,redBright:le,greenBright:Q,yellowBright:fe,blueBright:ie,magentaBright:ye,cyanBright:me,whiteBright:ee,bgBlackBright:oe,bgRedBright:de,bgGreenBright:pe,bgYellowBright:n,bgBlueBright:y,bgMagentaBright:D,bgCyanBright:P,bgWhiteBright:$}=g();s.bgBlack=G,s.bgBlackBright=oe,s.bgBlue=Y,s.bgBlueBright=y,s.bgCyan=k,s.bgCyanBright=P,s.bgGreen=te,s.bgGreenBright=pe,s.bgMagenta=ue,s.bgMagentaBright=D,s.bgRed=X,s.bgRedBright=de,s.bgWhite=ne,s.bgWhiteBright=$,s.bgYellow=z,s.bgYellowBright=n,s.black=T,s.blackBright=ce,s.blue=K,s.blueBright=ie,s.bold=b,s.createColors=g,s.cyan=V,s.cyanBright=me,s.dim=_,s.gray=Z,s.green=F,s.greenBright=Q,s.hidden=v,s.inverse=d,s.isColorSupported=w,s.italic=C,s.magenta=q,s.magentaBright=ye,s.red=R,s.redBright=le,s.reset=m,s.strikethrough=j,s.underline=M,s.white=S,s.whiteBright=ee,s.yellow=I,s.yellowBright=fe}}),Je=J({"lib/colors.js"(s,t){"use strict";var{LEVELS:o,LEVEL_NAMES:c}=we(),a=e(d=>d,"nocolor"),i={default:a,60:a,50:a,40:a,30:a,20:a,10:a,message:a,greyMessage:a},{createColors:u}=ke(),l=u({useColor:!0}),{white:O,bgRed:h,red:w,yellow:E,green:f,blue:L,gray:r,cyan:p}=l,g={default:O,60:h,50:w,40:E,30:f,20:L,10:r,message:p,greyMessage:r};function m(d){return d.reduce(function(v,[j,T]){return v[j]=typeof l[T]=="function"?l[T]:O,v},{default:O,message:p,greyMessage:r})}e(m,"resolveCustomColoredColorizer");function b(d){return function(v,j,{customLevels:T,customLevelNames:R}={}){let F=d?T||o:Object.assign({},o,T),I=d?R||c:Object.assign({},c,R),K="default";Number.isInteger(+v)?K=Object.prototype.hasOwnProperty.call(F,v)?v:K:K=Object.prototype.hasOwnProperty.call(I,v.toLowerCase())?I[v.toLowerCase()]:K;let q=F[K];return Object.prototype.hasOwnProperty.call(j,K)?j[K](q):j.default(q)}}e(b,"colorizeLevel");function _(d){let v=b(d),j=e(function(T,R){return v(T,i,R)},"customColoredColorizer");return j.message=i.message,j.greyMessage=i.greyMessage,j}e(_,"plainColorizer");function C(d){let v=b(d),j=e(function(T,R){return v(T,g,R)},"customColoredColorizer");return j.message=g.message,j.greyMessage=g.greyMessage,j}e(C,"coloredColorizer");function M(d,v){let j=m(d),T=v?j:Object.assign({},g,j),R=b(v),F=e(function(I,K){return R(I,T,K)},"customColoredColorizer");return F.message=F.message||T.message,F.greyMessage=F.greyMessage||T.greyMessage,F}e(M,"customColoredColorizerFactory"),t.exports=e(function(v=!1,j,T){return v&&j!==void 0?M(j,T):v?C(T):_(T)},"getColorizer")}}),Ze=J({"lib/utils/handle-custom-levels-opts.js"(s,t){"use strict";t.exports=o;function o(c){return c?typeof c=="string"?c.split(",").reduce((a,i,u)=>{let[l,O=u]=i.split(":");return a[O]=l.toUpperCase(),a},{default:"USERLVL"}):Object.prototype.toString.call(c)==="[object Object]"?Object.keys(c).reduce((a,i)=>(a[c[i]]=i.toUpperCase(),a),{default:"USERLVL"}):{}:{}}e(o,"handleCustomLevelsOpts")}}),Xe=J({"lib/utils/handle-custom-levels-names-opts.js"(s,t){"use strict";t.exports=o;function o(c){return c?typeof c=="string"?c.split(",").reduce((a,i,u)=>{let[l,O=u]=i.split(":");return a[l.toLowerCase()]=O,a},{}):Object.prototype.toString.call(c)==="[object Object]"?Object.keys(c).reduce((a,i)=>(a[i.toLowerCase()]=c[i],a),{}):{}:{}}e(o,"handleCustomLevelsNamesOpts")}}),Qe=J({"lib/utils/parse-factory-options.js"(s,t){t.exports=u;var{LEVEL_NAMES:o}=we(),c=Je(),a=Ze(),i=Xe();function u(l){let O=l.crlf?`\r
`:`
`,h="    ",{customPrettifiers:w,errorLikeObjectKeys:E,hideObject:f,levelFirst:L,levelKey:r,levelLabel:p,messageFormat:g,messageKey:m,minimumLevel:b,singleLine:_,timestampKey:C,translateTime:M}=l,d=l.errorProps.split(","),v=typeof l.useOnlyCustomProps=="boolean"?l.useOnlyCustomProps:l.useOnlyCustomProps==="true",j=a(l.customLevels),T=i(l.customLevels),R;l.customColors&&(R=l.customColors.split(",").reduce((S,Z)=>{let[G,X]=Z.split(":"),z=(v?l.customLevels:T[G]!==void 0)?T[G]:o[G],Y=z!==void 0?z:G;return S.push([Y,X]),S},[]));let F={customLevels:j,customLevelNames:T};v===!0&&!l.customLevels&&(F.customLevels=void 0,F.customLevelNames=void 0);let I=l.include!==void 0?new Set(l.include.split(",")):void 0,K=!I&&l.ignore?new Set(l.ignore.split(",")):void 0,q=c(l.colorize,R,v),V=l.colorizeObjects?q:c(!1,[],!1);return{EOL:O,IDENT:h,colorizer:q,customColors:R,customLevelNames:T,customLevels:j,customPrettifiers:w,customProperties:F,errorLikeObjectKeys:E,errorProps:d,hideObject:f,ignoreKeys:K,includeKeys:I,levelFirst:L,levelKey:r,levelLabel:p,messageFormat:g,messageKey:m,minimumLevel:b,objectColorizer:V,singleLine:_,timestampKey:C,translateTime:M,useOnlyCustomProps:v}}e(u,"parseFactoryOptions")}}),je=Qe();var er={colorize:!0,colorizeObjects:!0,crlf:!1,customColors:null,customLevels:null,customPrettifiers:{},errorLikeObjectKeys:["err","error"],errorProps:"",hideObject:!1,ignore:"hostname",include:void 0,levelFirst:!1,levelKey:"level",levelLabel:"levelLabel",messageFormat:null,messageKey:"msg",minimumLevel:void 0,outputStream:console,singleLine:!1,timestampKey:"timestamp",translateTime:"SYS:HH:MM:ss",useOnlyCustomProps:!0};function rr(s){let t=je(Object.assign({},er,s));return Me.bind({...t,context:t})}e(rr,"prettyFactory");var Ce=rr({customPrettifiers:{time:s=>`${s}`}}),ae=class extends U.handlers.BaseHandler{static{e(this,"ConsoleHandler")}format(t){try{let o=JSON.parse(t.msg);return o.level==="warning"?o.level="warn":o.level=t.levelName,o.timestamp||(o.timestamp=t.datetime),typeof o.timestamp=="object"&&o.timestamp!==null&&(o.timestamp=t.datetime),delete o.hostname,Ce(o)}catch{return Ce({level:t.levelName,timestamp:t.datetime,msg:t.msg})}}log(t){console.log(t)}};await U.setup({handlers:{console:new ae("DEBUG")},loggers:{default:{level:"DEBUG",handlers:["console"]}}});var ve=class{static{e(this,"DefaultConsoleAdapter")}debug(...t){t.forEach(o=>{console.debug(JSON.stringify(o))})}info(...t){t.forEach(o=>{console.info(JSON.stringify(o))})}log(...t){t.forEach(o=>{console.log(JSON.stringify(o))})}warn(...t){t.forEach(o=>{console.warn(JSON.stringify(o))})}error(...t){t.forEach(o=>{console.error(JSON.stringify(o))})}},be=class{static{e(this,"LocalConsoleAdapter")}debug(...t){t.forEach(o=>{U.debug(o)})}info(...t){t.forEach(o=>{U.info(o)})}log(...t){t.forEach(o=>{U.info(o)})}warn(...t){t.forEach(o=>{U.warning(o)})}error(...t){t.forEach(o=>{U.error(o)})}},ut=new ve,Te=new be;var tr="system-logger";globalThis.__ZUPLO_SERVICE_PROVIDER&&globalThis.__ZUPLO_SERVICE_PROVIDER.addService(tr,{logger:Te,captureUserLogs:!0});export{tr as SYSTEM_LOGGER};
